/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import { Component, QueryList, ContentChildren, Input, ViewChildren } from '@angular/core';
import { interval } from 'rxjs';
import { CarouselItemDirective } from './carousel-item.directive';
import { first } from 'rxjs/operators';
var CarouselComponent = /** @class */ (function () {
    function CarouselComponent() {
        /**
         * Enable autoChange of carousel items
         */
        this.autochange = false;
        /**
         * Enable transit animation
         */
        this.animationType = 'none';
        /**
         * Period for autoChange
         */
        this.period = 5000;
        this._activeIndex = 0;
        this._isAnimation = false;
    }
    /**
     * @return {?}
     */
    CarouselComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.setupCarousel();
    };
    //***************************************************************************************************************
    //-Setup---------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    //***************************************************************************************************************
    //-Setup---------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * @return {?}
     */
    CarouselComponent.prototype.setupCarousel = 
    //***************************************************************************************************************
    //-Setup---------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this._subscriber)
            this._subscriber.unsubscribe();
        this.setItemActive(this._activeIndex);
        if (this.autochange)
            this._subscriber = interval(this.period)
                .subscribe(function () {
                _this.setItemInactive(_this._activeIndex);
                _this._activeIndex = _this._activeIndex + 1 >= _this.carouselItems.length ? 0 : _this._activeIndex + 1;
                _this.setItemActive(_this._activeIndex);
            });
    };
    //***************************************************************************************************************
    //-API-----------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    //***************************************************************************************************************
    //-API-----------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * @param {?} indexPath
     * @return {?}
     */
    CarouselComponent.prototype.selectAt = 
    //***************************************************************************************************************
    //-API-----------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * @param {?} indexPath
     * @return {?}
     */
    function (indexPath) {
        if (!this._isAnimation) {
            this.setItemInactive(this._activeIndex);
            this._activeIndex = indexPath >= this.carouselItems.length ? this.carouselItems.length - 1 : indexPath;
            this._activeIndex = indexPath < 0 ? 0 : indexPath;
            this.setItemActive(this._activeIndex);
            this.setupCarousel();
        }
    };
    /**
     * @return {?}
     */
    CarouselComponent.prototype.next = /**
     * @return {?}
     */
    function () {
        if (!this._isAnimation) {
            this.setItemInactive(this._activeIndex);
            this._activeIndex = this._activeIndex + 1 >= this.carouselItems.length ? 0 : this._activeIndex + 1;
            this.setItemActive(this._activeIndex);
            this.setupCarousel();
        }
    };
    /**
     * @return {?}
     */
    CarouselComponent.prototype.prev = /**
     * @return {?}
     */
    function () {
        if (!this._isAnimation) {
            this.setItemInactive(this._activeIndex);
            this._activeIndex = this._activeIndex - 1 < 0 ? this.carouselItems.length - 1 : this._activeIndex - 1;
            this.setItemActive(this._activeIndex);
            this.setupCarousel();
        }
    };
    //***************************************************************************************************************
    //-Help----------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    //***************************************************************************************************************
    //-Help----------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * @param {?} index
     * @return {?}
     */
    CarouselComponent.prototype.setItemActive = 
    //***************************************************************************************************************
    //-Help----------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        var _this = this;
        /** @type {?} */
        var item = this.carouselItems.find(function (_, i) { return i == index; });
        switch (this.animationType) {
            case 'fade':
                if (item) {
                    this._isAnimation = true;
                    item.nativeElement.classList.add('active', 'fade-in');
                    interval(1005).pipe(first())
                        .subscribe(function () {
                        item.nativeElement.classList.remove('fade-in');
                        _this._isAnimation = false;
                    });
                }
                break;
            default:
                if (item)
                    item.nativeElement.classList.add('active');
                break;
        }
    };
    /**
     * @param {?} index
     * @return {?}
     */
    CarouselComponent.prototype.setItemInactive = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        /** @type {?} */
        var item = this.carouselItems.find(function (_, i) { return i == index; });
        switch (this.animationType) {
            case 'fade':
                if (item) {
                    item.nativeElement.classList.add('fade-out');
                    interval(1005).pipe(first())
                        .subscribe(function () {
                        item.nativeElement.classList.remove('active', 'fade-out');
                    });
                }
                break;
            default:
                if (item)
                    item.nativeElement.classList.remove('active');
                break;
        }
    };
    CarouselComponent.decorators = [
        { type: Component, args: [{
                    selector: 'carousel',
                    template: "<div class=\"carousel\" [style.position]=\"animationType == 'none' ? 'static' : 'relative'\">\r\n    <ng-template ngFor let-item [ngForOf]=\"carouselInners\">\r\n        <div #carouselItems class=\"carousel__item\">\r\n            <ng-template [ngTemplateOutlet]=\"item.templateRef\"></ng-template>\r\n        </div>\r\n    </ng-template>\r\n</div>",
                    styles: [".carousel__item{display:none;transition:transform 1s ease-in-out,opacity 1s ease-in-out,-webkit-transform 1s ease-in-out}.carousel__item.active{display:block}.carousel__item.fade-out{position:absolute;top:0;right:0;bottom:0;left:0;-webkit-animation:1s linear fadeOut;animation:1s linear fadeOut}.carousel__item.fade-in{-webkit-animation:1s linear fadeIn;animation:1s linear fadeIn}@-webkit-keyframes fadeIn{0%{opacity:0}100%{opacity:1}}@keyframes fadeIn{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes fadeOut{0%{opacity:1}100%{opacity:0}}@keyframes fadeOut{0%{opacity:1}100%{opacity:0}}"]
                }] }
    ];
    CarouselComponent.propDecorators = {
        carouselInners: [{ type: ContentChildren, args: [CarouselItemDirective,] }],
        carouselItems: [{ type: ViewChildren, args: ['carouselItems',] }],
        autochange: [{ type: Input }],
        animationType: [{ type: Input }],
        period: [{ type: Input }]
    };
    return CarouselComponent;
}());
export { CarouselComponent };
if (false) {
    /** @type {?} */
    CarouselComponent.prototype.carouselInners;
    /** @type {?} */
    CarouselComponent.prototype.carouselItems;
    /**
     * Enable autoChange of carousel items
     * @type {?}
     */
    CarouselComponent.prototype.autochange;
    /**
     * Enable transit animation
     * @type {?}
     */
    CarouselComponent.prototype.animationType;
    /**
     * Period for autoChange
     * @type {?}
     */
    CarouselComponent.prototype.period;
    /** @type {?} */
    CarouselComponent.prototype._activeIndex;
    /** @type {?} */
    CarouselComponent.prototype._subscriber;
    /** @type {?} */
    CarouselComponent.prototype._isAnimation;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2Fyb3VzZWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LWNhcm91c2Vscy8iLCJzb3VyY2VzIjpbImNhcm91c2VsL2Nhcm91c2VsLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQTZCLE1BQU0sZUFBZSxDQUFDO0FBQ3RILE9BQU8sRUFBZ0IsUUFBUSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRTlDLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUV2QztJQUFBOzs7O1FBV2EsZUFBVSxHQUFZLEtBQUssQ0FBQzs7OztRQUU1QixrQkFBYSxHQUFvQixNQUFNLENBQUM7Ozs7UUFFeEMsV0FBTSxHQUFXLElBQUksQ0FBQztRQUV2QixpQkFBWSxHQUFXLENBQUMsQ0FBQztRQUV6QixpQkFBWSxHQUFZLEtBQUssQ0FBQztJQThGMUMsQ0FBQzs7OztJQTVGRywyQ0FBZTs7O0lBQWY7UUFDSSxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDekIsQ0FBQztJQUVELGlIQUFpSDtJQUNqSCxpSEFBaUg7SUFDakgsaUhBQWlIOzs7Ozs7O0lBQ3pHLHlDQUFhOzs7Ozs7O0lBQXJCO1FBQUEsaUJBV0M7UUFWRyxJQUFJLElBQUksQ0FBQyxXQUFXO1lBQ2hCLElBQUksQ0FBQyxXQUFXLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDbkMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDdEMsSUFBSSxJQUFJLENBQUMsVUFBVTtZQUNmLElBQUksQ0FBQyxXQUFXLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7aUJBQ25DLFNBQVMsQ0FBQztnQkFDUCxLQUFJLENBQUMs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QUN4RCxNQUFNO1NBQ2I7SUFDTCxDQUFDOztnQkEvR0osU0FBUyxTQUFDO29CQUNQLFFBQVEsRUFBRSxVQUFVO29CQUNwQix3V0FBc0M7O2lCQUV6Qzs7O2lDQUdJLGVBQWUsU0FBQyxxQkFBcUI7Z0NBQ3JDLFlBQVksU0FBQyxlQUFlOzZCQUc1QixLQUFLO2dDQUVMLEtBQUs7eUJBRUwsS0FBSzs7SUFrR1Ysd0JBQUM7Q0FBQSxBQWpIRCxJQWlIQztTQTVHWSxpQkFBaUI7OztJQUUxQiwyQ0FBeUY7O0lBQ3pGLDBDQUFpRjs7Ozs7SUFHakYsdUNBQXFDOzs7OztJQUVyQywwQ0FBaUQ7Ozs7O0lBRWpELG1DQUErQjs7SUFFL0IseUNBQWlDOztJQUNqQyx3Q0FBa0M7O0lBQ2xDLHlDQUFzQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgUXVlcnlMaXN0LCBDb250ZW50Q2hpbGRyZW4sIElucHV0LCBWaWV3Q2hpbGRyZW4sIEVsZW1lbnRSZWYsIEFmdGVyVmlld0luaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgU3Vic2NyaXB0aW9uLCBpbnRlcnZhbCB9IGZyb20gJ3J4anMnO1xyXG5cclxuaW1wb3J0IHsgQ2Fyb3VzZWxJdGVtRGlyZWN0aXZlIH0gZnJvbSAnLi9jYXJvdXNlbC1pdGVtLmRpcmVjdGl2ZSc7XHJcbmltcG9ydCB7IGZpcnN0IH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ2Nhcm91c2VsJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnY2Fyb3VzZWwuY29tcG9uZW50Lmh0bWwnLFxyXG4gICAgc3R5bGVVcmxzOiBbJ2Nhcm91c2VsLmNvbXBvbmVudC5zY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIENhcm91c2VsQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCB7XHJcblxyXG4gICAgQENvbnRlbnRDaGlsZHJlbihDYXJvdXNlbEl0ZW1EaXJlY3RpdmUpIGNhcm91c2VsSW5uZXJzOiBRdWVyeUxpc3Q8Q2Fyb3VzZWxJdGVtRGlyZWN0aXZlPjtcclxuICAgIEBWaWV3Q2hpbGRyZW4oJ2Nhcm91c2VsSXRlbXMnKSBjYXJvdXNlbEl0ZW1zOiBRdWVyeUxpc3Q8RWxlbWVudFJlZjxIVE1MRWxlbWVudD4+O1xyXG5cclxuICAgIC8qKiBFbmFibGUgYXV0b0NoYW5nZSBvZiBjYXJvdXNlbCBpdGVtcyAqL1xyXG4gICAgQElucHV0KCkgYXV0b2NoYW5nZTogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgLyoqIEVuYWJsZSB0cmFuc2l0IGFuaW1hdGlvbiAqL1xyXG4gICAgQElucHV0KCkgYW5pbWF0aW9uVHlwZTogJ25vbmUnIHwgJ2ZhZGUnID0gJ25vbmUnO1xyXG4gICAgLyoqIFBlcmlvZCBmb3IgYXV0b0NoYW5nZSAqL1xyXG4gICAgQElucHV0KCkgcGVyaW9kOiBudW1iZXIgPSA1MDAwO1xyXG5cclxuICAgIHByaXZhdGUgX2FjdGl2ZUluZGV4OiBudW1iZXIgPSAwO1xyXG4gICAgcHJpdmF0ZSBfc3Vic2NyaWJlcjogU3Vic2NyaXB0aW9uO1xyXG4gICAgcHJpdmF0ZSBfaXNBbmltYXRpb246IGJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICAgICAgdGhpcy5zZXR1cENhcm91c2VsKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICAgIC8vLVNldHVwLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgICAvLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gICAgcHJpdmF0ZSBzZXR1cENhcm91c2VsKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9zdWJzY3JpYmVyKVxyXG4gICAgICAgICAgICB0aGlzLl9zdWJzY3JpYmVyLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgdGhpcy5zZXRJdGVtQWN0aXZlKHRoaXMuX2FjdGl2ZUluZGV4KTtcclxuICAgICAgICBpZiAodGhpcy5hdXRvY2hhbmdlKVxyXG4gICAgICAgICAgICB0aGlzLl9zdWJzY3JpYmVyID0gaW50ZXJ2YWwodGhpcy5wZXJpb2QpXHJcbiAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEl0ZW1JbmFjdGl2ZSh0aGlzLl9hY3RpdmVJbmRleCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWN0aXZlSW5kZXggPSB0aGlzLl9hY3RpdmVJbmRleCArIDEgPj0gdGhpcy5jYXJvdXNlbEl0ZW1zLmxlbmd0aCA/IDAgOiB0aGlzLl9hY3RpdmVJbmRleCArIDE7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRJdGVtQWN0aXZlKHRoaXMuX2FjdGl2ZUluZGV4KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAgICAvLy1BUEktLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gICAgLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICAgIHNlbGVjdEF0KGluZGV4UGF0aDogbnVtYmVyKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9pc0FuaW1hdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLnNldEl0ZW1JbmFjdGl2ZSh0aGlzLl9hY3RpdmVJbmRleCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2FjdGl2ZUluZGV4ID0gaW5kZXhQYXRoID49IHRoaXMuY2Fyb3VzZWxJdGVtcy5sZW5ndGggPyB0aGlzLmNhcm91c2VsSXRlbXMubGVuZ3RoIC0gMSA6IGluZGV4UGF0aDtcclxuICAgICAgICAgICAgdGhpcy5fYWN0aXZlSW5kZXggPSBpbmRleFBhdGggPCAwID8gMCA6IGluZGV4UGF0aDtcclxuICAgICAgICAgICAgdGhpcy5zZXRJdGVtQWN0aXZlKHRoaXMuX2FjdGl2ZUluZGV4KTtcclxuICAgICAgICAgICAgdGhpcy5zZXR1cENhcm91c2VsKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5leHQoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9pc0FuaW1hdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLnNldEl0ZW1JbmFjdGl2ZSh0aGlzLl9hY3RpdmVJbmRleCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2FjdGl2ZUluZGV4ID0gdGhpcy5fYWN0aXZlSW5kZXggKyAxID49IHRoaXMuY2Fyb3VzZWxJdGVtcy5sZW5ndGggPyAwIDogdGhpcy5fYWN0aXZlSW5kZXggKyAxO1xyXG4gICAgICAgICAgICB0aGlzLnNldEl0ZW1BY3RpdmUodGhpcy5fYWN0aXZlSW5kZXgpO1xyXG4gICAgICAgICAgICB0aGlzLnNldHVwQ2Fyb3VzZWwoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJldigpIHtcclxuICAgICAgICBpZiAoIXRoaXMuX2lzQW5pbWF0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0SXRlbUluYWN0aXZlKHRoaXMuX2FjdGl2ZUluZGV4KTtcclxuICAgICAgICAgICAgdGhpcy5fYWN0aXZlSW5kZXggPSB0aGlzLl9hY3RpdmVJbmRleCAtIDEgPCAwID8gdGhpcy5jYXJvdXNlbEl0ZW1zLmxlbmd0aCAtIDEgOiB0aGlzLl9hY3RpdmVJbmRleCAtIDE7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0SXRlbUFjdGl2ZSh0aGlzLl9hY3RpdmVJbmRleCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0dXBDYXJvdXNlbCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gICAgLy8tSGVscC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICAgIC8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAgICBwcml2YXRlIHNldEl0ZW1BY3RpdmUoaW5kZXg6IG51bWJlcikge1xyXG4gICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLmNhcm91c2VsSXRlbXMuZmluZCgoXywgaSkgPT4gaSA9PSBpbmRleCk7XHJcbiAgICAgICAgc3dpdGNoICh0aGlzLmFuaW1hdGlvblR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAnZmFkZSc6XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzQW5pbWF0aW9uID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtLm5hdGl2ZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJywgJ2ZhZGUtaW4nKTtcclxuICAgICAgICAgICAgICAgICAgICBpbnRlcnZhbCgxMDA1KS5waXBlKGZpcnN0KCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5uYXRpdmVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2ZhZGUtaW4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2lzQW5pbWF0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbSkgaXRlbS5uYXRpdmVFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0SXRlbUluYWN0aXZlKGluZGV4OiBudW1iZXIpIHtcclxuICAgICAgICBjb25zdCBpdGVtID0gdGhpcy5jYXJvdXNlbEl0ZW1zLmZpbmQoKF8sIGkpID0+IGkgPT0gaW5kZXgpO1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5hbmltYXRpb25UeXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ2ZhZGUnOlxyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtLm5hdGl2ZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnZmFkZS1vdXQnKTtcclxuICAgICAgICAgICAgICAgICAgICBpbnRlcnZhbCgxMDA1KS5waXBlKGZpcnN0KCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5uYXRpdmVFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScsICdmYWRlLW91dCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0pIGl0ZW0ubmF0aXZlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn1cclxuIl19