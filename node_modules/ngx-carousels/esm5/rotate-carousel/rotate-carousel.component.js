/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, Output, EventEmitter, ContentChildren, QueryList, ViewChild, ElementRef } from '@angular/core';
import { timer } from 'rxjs';
import { RotateCarouselItemDirective } from './rotate-carousel-item.directive';
/** @type {?} */
var DEFAULT_WIDTH = '300px';
/** @type {?} */
var DEFAULT_HEIGHT = '200px';
/** @type {?} */
var DEFAULT_DEPTH = '510px';
/** @type {?} */
var DEFAULT_PERIOD = 3500;
/** @type {?} */
var FULL_ANGLE = 360;
var RotateCarouselComponent = /** @class */ (function () {
    function RotateCarouselComponent() {
        /**
         * Emit event of rotation start
         */
        this.rotationStart = new EventEmitter();
        /**
         * Emit event of rotation end
         */
        this.rotationEnd = new EventEmitter();
        /**
         * Width of content in carousel item
         */
        this.width = DEFAULT_WIDTH;
        /**
         * Height of content in carousel item
         */
        this.height = DEFAULT_HEIGHT;
        /**
         * Depth of the center of carousel
         */
        this.depth = DEFAULT_DEPTH;
        /**
         * Period of carousel rotation
         */
        this.period = DEFAULT_PERIOD;
        /**
         * Direction of rotation
         */
        this.direction = 'forward';
        this._activeIndex = 0;
    }
    /**
     * @return {?}
     */
    RotateCarouselComponent.prototype.ngAfterContentInit = /**
     * @return {?}
     */
    function () {
        this.calcItemsAngle();
        this.setupRotation();
        //this.calcHeight();
    };
    /**
     * @return {?}
     */
    RotateCarouselComponent.prototype.ngOnChanges = /**
     * @return {?}
     */
    function () {
        this.setupRotation();
        //this.calcHeight();
    };
    //***************************************************************************************************************
    //-Setup---------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    //***************************************************************************************************************
    //-Setup---------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * @return {?}
     */
    RotateCarouselComponent.prototype.calcItemsAngle = 
    //***************************************************************************************************************
    //-Setup---------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * @return {?}
     */
    function () {
        var _this = this;
        this._angleStep = FULL_ANGLE / this.rotateItems.length;
        /** @type {?} */
        var angle = 0;
        this.rotateItems.forEach(function (x) {
            x.angle = angle;
            angle += _this._angleStep;
        });
    };
    /**
     * @return {?}
     */
    RotateCarouselComponent.prototype.setupRotation = /**
     * @return {?}
     */
    function () {
        if (!Number.isNaN((/** @type {?} */ (this.period)) % 1))
            this._period = parseInt((/** @type {?} */ (this.period)));
        else {
            /** @type {?} */
            var periodStr = (/** @type {?} */ (this.period));
            // split string like '1003ms' to '1000' and 'ms'
            /** @type {?} */
            var values = periodStr.replace(/\'/g, '').split(/([0-9]*\.?[0-9])/);
            this._period = values[2] == 's' ? parseInt(values[1]) * 1000 : parseInt(values[1]);
        }
        if (this._rotationTimerSubscription)
            this._rotationTimerSubscription.unsubscribe();
        this._rotationTimerSubscription = this.setRotationTimer();
    };
    /**
     * @return {?}
     */
    RotateCarouselComponent.prototype.calcHeight = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var maxH = Math.max.apply(Math, tslib_1.__spread([null], this.rotateItems.map(function (x) { return x.templateRef.elementRef.nativeElement.clientHeight; })));
        if (!this.height)
            this.height = maxH + 'px';
    };
    //***************************************************************************************************************
    //-Events--------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    //***************************************************************************************************************
    //-Events--------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * @return {?}
     */
    RotateCarouselComponent.prototype.onRotationStart = 
    //***************************************************************************************************************
    //-Events--------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * @return {?}
     */
    function () {
        this.rotationStart.emit(this._activeIndex);
    };
    /**
     * @param {?} $event
     * @return {?}
     */
    RotateCarouselComponent.prototype.onRotateEnd = /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        if (this._activeIndex == 0) {
            this.carouselInner.nativeElement.style.transition = 'none';
            this.carouselInner.nativeElement.style.transform = 'rotateY(0deg)';
        }
        this.rotationEnd.emit(this._activeIndex);
    };
    //***************************************************************************************************************
    //-Style-Visibility-Availability---------------------------------------------------------------------------------
    //***************************************************************************************************************
    //***************************************************************************************************************
    //-Style-Visibility-Availability---------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * @return {?}
     */
    RotateCarouselComponent.prototype.getCarouselStyle = 
    //***************************************************************************************************************
    //-Style-Visibility-Availability---------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var width = this.width;
        /** @type {?} */
        var height = this.height;
        /** @type {?} */
        var depth = this.depth;
        return { width: width, height: height, transform: 'translateZ(-' + depth + ')' };
    };
    /**
     * @param {?} item
     * @return {?}
     */
    RotateCarouselComponent.prototype.getItemStyle = /**
     * @param {?} item
     * @return {?}
     */
    function (item) {
        /** @type {?} */
        var depth = this.depth;
        /** @type {?} */
        var style = { transform: 'rotateY(' + item.angle + 'deg) translateZ(' + depth + ')' };
        return style;
    };
    //***************************************************************************************************************
    //-Methods-------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    //***************************************************************************************************************
    //-Methods-------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * @param {?} indexPath
     * @return {?}
     */
    RotateCarouselComponent.prototype.selectAt = 
    //***************************************************************************************************************
    //-Methods-------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * @param {?} indexPath
     * @return {?}
     */
    function (indexPath) {
        this._rotationTimerSubscription.unsubscribe();
        this.carouselInner.nativeElement.style.transform = "rotateY(" + indexPath * this._angleStep + "deg)";
        this._rotationTimerSubscription = this.setRotationTimer();
    };
    //***************************************************************************************************************
    //-Help----------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    //***************************************************************************************************************
    //-Help----------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * @return {?}
     */
    RotateCarouselComponent.prototype.setRotationTimer = 
    //***************************************************************************************************************
    //-Help----------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * @return {?}
     */
    function () {
        var _this = this;
        return timer(0, this._period)
            .subscribe(function (i) {
            _this._activeIndex = i % _this.rotateItems.length;
            /** @type {?} */
            var angle;
            if (_this._activeIndex == 1)
                _this.carouselInner.nativeElement.style.transition = "transform " + _this._period / 2 + "ms ease-in-out";
            if (i > 0 && _this._activeIndex == 0)
                angle = _this.rotateItems.length * _this._angleStep * (_this.direction == 'forward' ? -1 : 1);
            else
                angle = _this._activeIndex * _this._angleStep * (_this.direction == 'forward' ? -1 : 1);
            _this.carouselInner.nativeElement.style.transform = "rotateY(" + angle + "deg)";
            _this.onRotationStart();
        });
    };
    RotateCarouselComponent.decorators = [
        { type: Component, args: [{
                    selector: 'rotate-carousel',
                    template: "<figure class=\"carousel\">\r\n    <div class=\"carousel__content\" [ngStyle]=\"getCarouselStyle()\">\r\n        <div #carouselInner class=\"carousel__inner\" (transitionend)=\"onRotateEnd($event)\">\r\n            <ng-template ngFor let-item [ngForOf]=\"rotateItems\">\r\n                <div class=\"carousel__item\" [ngStyle]=\"getItemStyle(item)\">\r\n                    <ng-template [ngTemplateOutlet]=\"item.templateRef\"></ng-template>\r\n                </div>\r\n            </ng-template>\r\n        </div>\r\n    </div>\r\n</figure>",
                    styles: [":host{width:100%}.carousel{display:flex;justify-content:center;-webkit-perspective:1000px;perspective:1000px}.carousel__content{-webkit-transform:translateZ(-40vw);transform:translateZ(-40vw);-webkit-transform-style:preserve-3d;transform-style:preserve-3d}.carousel__inner{height:100%;-webkit-transform-style:preserve-3d;transform-style:preserve-3d}.carousel__item{display:flex;align-items:center;position:absolute;height:100%;width:100%}.carousel__item img{height:100%;width:100%;-o-object-fit:cover;object-fit:cover;-o-object-position:center;object-position:center;border-radius:15px}"]
                }] }
    ];
    RotateCarouselComponent.propDecorators = {
        rotateItems: [{ type: ContentChildren, args: [RotateCarouselItemDirective,] }],
        carouselInner: [{ type: ViewChild, args: ['carouselInner',] }],
        rotationStart: [{ type: Output }],
        rotationEnd: [{ type: Output }],
        width: [{ type: Input }],
        height: [{ type: Input }],
        depth: [{ type: Input }],
        period: [{ type: Input }],
        direction: [{ type: Input }]
    };
    return RotateCarouselComponent;
}());
export { RotateCarouselComponent };
if (false) {
    /** @type {?} */
    RotateCarouselComponent.prototype.rotateItems;
    /** @type {?} */
    RotateCarouselComponent.prototype.carouselInner;
    /**
     * Emit event of rotation start
     * @type {?}
     */
    RotateCarouselComponent.prototype.rotationStart;
    /**
     * Emit event of rotation end
     * @type {?}
     */
    RotateCarouselComponent.prototype.rotationEnd;
    /**
     * Width of content in carousel item
     * @type {?}
     */
    RotateCarouselComponent.prototype.width;
    /**
     * Height of content in carousel item
     * @type {?}
     */
    RotateCarouselComponent.prototype.height;
    /**
     * Depth of the center of carousel
     * @type {?}
     */
    RotateCarouselComponent.prototype.depth;
    /**
     * Period of carousel rotation
     * @type {?}
     */
    RotateCarouselComponent.prototype.period;
    /**
     * Direction of rotation
     * @type {?}
     */
    RotateCarouselComponent.prototype.direction;
    /** @type {?} */
    RotateCarouselComponent.prototype._period;
    /** @type {?} */
    RotateCarouselComponent.prototype._angleStep;
    /** @type {?} */
    RotateCarouselComponent.prototype._rotationTimerSubscription;
    /** @type {?} */
    RotateCarouselComponent.prototype._activeIndex;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm90YXRlLWNhcm91c2VsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1jYXJvdXNlbHMvIiwic291cmNlcyI6WyJyb3RhdGUtY2Fyb3VzZWwvcm90YXRlLWNhcm91c2VsLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFDSCxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsZUFBZSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUU1RixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsS0FBSyxFQUFnQixNQUFNLE1BQU0sQ0FBQztBQUUzQyxPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQzs7SUFFekUsYUFBYSxHQUFHLE9BQU87O0lBQ3ZCLGNBQWMsR0FBRyxPQUFPOztJQUN4QixhQUFhLEdBQUcsT0FBTzs7SUFDdkIsY0FBYyxHQUFHLElBQUk7O0lBRXJCLFVBQVUsR0FBRyxHQUFHO0FBRXRCO0lBQUE7Ozs7UUFXYyxrQkFBYSxHQUFHLElBQUksWUFBWSxFQUFVLENBQUM7Ozs7UUFFM0MsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDOzs7O1FBRTFDLFVBQUssR0FBVyxhQUFhLENBQUM7Ozs7UUFFOUIsV0FBTSxHQUFXLGNBQWMsQ0FBQzs7OztRQUVoQyxVQUFLLEdBQVcsYUFBYSxDQUFDOzs7O1FBRTlCLFdBQU0sR0FBb0IsY0FBYyxDQUFDOzs7O1FBRXpDLGNBQVMsR0FBMEIsU0FBUyxDQUFDO1FBSzlDLGlCQUFZLEdBQVcsQ0FBQyxDQUFDO0lBdUdyQyxDQUFDOzs7O0lBckdHLG9EQUFrQjs7O0lBQWxCO1FBQ0ksSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUNyQixvQkFBb0I7SUFDeEIsQ0FBQzs7OztJQUVELDZDQUFXOzs7SUFBWDtRQUNJLElBQUksQ0FB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Ozs7OztJQUV2Qyx5Q0FBeUM7Ozs7O0lBRXpDLHdDQUF1Qzs7Ozs7SUFFdkMseUNBQWtEOzs7OztJQUVsRCw0Q0FBc0Q7O0lBRXRELDBDQUF3Qjs7SUFDeEIsNkNBQTJCOztJQUMzQiw2REFBaUQ7O0lBQ2pELCtDQUFpQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgICBDb21wb25lbnQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgQ29udGVudENoaWxkcmVuLCBRdWVyeUxpc3QsIFZpZXdDaGlsZCwgRWxlbWVudFJlZixcclxuICAgIEFmdGVyQ29udGVudEluaXQsIE9uQ2hhbmdlc1xyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyB0aW1lciwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XHJcblxyXG5pbXBvcnQgeyBSb3RhdGVDYXJvdXNlbEl0ZW1EaXJlY3RpdmUgfSBmcm9tICcuL3JvdGF0ZS1jYXJvdXNlbC1pdGVtLmRpcmVjdGl2ZSc7XHJcblxyXG5jb25zdCBERUZBVUxUX1dJRFRIID0gJzMwMHB4JztcclxuY29uc3QgREVGQVVMVF9IRUlHSFQgPSAnMjAwcHgnO1xyXG5jb25zdCBERUZBVUxUX0RFUFRIID0gJzUxMHB4JztcclxuY29uc3QgREVGQVVMVF9QRVJJT0QgPSAzNTAwO1xyXG5cclxuY29uc3QgRlVMTF9BTkdMRSA9IDM2MDtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdyb3RhdGUtY2Fyb3VzZWwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL3JvdGF0ZS1jYXJvdXNlbC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi9yb3RhdGUtY2Fyb3VzZWwuY29tcG9uZW50LnNjc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgUm90YXRlQ2Fyb3VzZWxDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlckNvbnRlbnRJbml0LCBPbkNoYW5nZXMge1xyXG5cclxuICAgIEBDb250ZW50Q2hpbGRyZW4oUm90YXRlQ2Fyb3VzZWxJdGVtRGlyZWN0aXZlKSByb3RhdGVJdGVtczogUXVlcnlMaXN0PFJvdGF0ZUNhcm91c2VsSXRlbURpcmVjdGl2ZT47XHJcbiAgICBAVmlld0NoaWxkKCdjYXJvdXNlbElubmVyJykgY2Fyb3VzZWxJbm5lcjogRWxlbWVudFJlZjtcclxuXHJcbiAgICAvKiogRW1pdCBldmVudCBvZiByb3RhdGlvbiBzdGFydCAqL1xyXG4gICAgQE91dHB1dCgpIHJvdGF0aW9uU3RhcnQgPSBuZXcgRXZlbnRFbWl0dGVyPG51bWJlcj4oKTtcclxuICAgIC8qKiBFbWl0IGV2ZW50IG9mIHJvdGF0aW9uIGVuZCAqL1xyXG4gICAgQE91dHB1dCgpIHJvdGF0aW9uRW5kID0gbmV3IEV2ZW50RW1pdHRlcjxudW1iZXI+KCk7XHJcbiAgICAvKiogV2lkdGggb2YgY29udGVudCBpbiBjYXJvdXNlbCBpdGVtICovXHJcbiAgICBASW5wdXQoKSB3aWR0aDogc3RyaW5nID0gREVGQVVMVF9XSURUSDtcclxuICAgIC8qKiBIZWlnaHQgb2YgY29udGVudCBpbiBjYXJvdXNlbCBpdGVtICovXHJcbiAgICBASW5wdXQoKSBoZWlnaHQ6IHN0cmluZyA9IERFRkFVTFRfSEVJR0hUO1xyXG4gICAgLyoqIERlcHRoIG9mIHRoZSBjZW50ZXIgb2YgY2Fyb3VzZWwgKi9cclxuICAgIEBJbnB1dCgpIGRlcHRoOiBzdHJpbmcgPSBERUZBVUxUX0RFUFRIO1xyXG4gICAgLyoqIFBlcmlvZCBvZiBjYXJvdXNlbCByb3RhdGlvbiAqL1xyXG4gICAgQElucHV0KCkgcGVyaW9kOiBudW1iZXIgfCBzdHJpbmcgPSBERUZBVUxUX1BFUklPRDtcclxuICAgIC8qKiBEaXJlY3Rpb24gb2Ygcm90YXRpb24gKi9cclxuICAgIEBJbnB1dCgpIGRpcmVjdGlvbjogJ2ZvcndhcmQnIHwgJ3JldmVyc2UnID0gJ2ZvcndhcmQnO1xyXG5cclxuICAgIHByaXZhdGUgX3BlcmlvZDogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBfYW5nbGVTdGVwOiBudW1iZXI7XHJcbiAgICBwcml2YXRlIF9yb3RhdGlvblRpbWVyU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XHJcbiAgICBwcml2YXRlIF9hY3RpdmVJbmRleDogbnVtYmVyID0gMDtcclxuXHJcbiAgICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5jYWxjSXRlbXNBbmdsZSgpO1xyXG4gICAgICAgIHRoaXMuc2V0dXBSb3RhdGlvbigpO1xyXG4gICAgICAgIC8vdGhpcy5jYWxjSGVpZ2h0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkNoYW5nZXMoKSB7XHJcbiAgICAgICAgdGhpcy5zZXR1cFJvdGF0aW9uKCk7XHJcbiAgICAgICAgLy90aGlzLmNhbGNIZWlnaHQoKTtcclxuICAgIH1cclxuXHJcbi8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbi8vLVNldHVwLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbi8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAgICBwcml2YXRlIGNhbGNJdGVtc0FuZ2xlKCkge1xyXG4gICAgICAgIHRoaXMuX2FuZ2xlU3RlcCA9IEZVTExfQU5HTEUgLyB0aGlzLnJvdGF0ZUl0ZW1zLmxlbmd0aDtcclxuICAgICAgICBsZXQgYW5nbGUgPSAwO1xyXG4gICAgICAgIHRoaXMucm90YXRlSXRlbXMuZm9yRWFjaCh4ID0+IHtcclxuICAgICAgICAgICAgeC5hbmdsZSA9IGFuZ2xlO1xyXG4gICAgICAgICAgICBhbmdsZSArPSB0aGlzLl9hbmdsZVN0ZXA7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZXR1cFJvdGF0aW9uKCkge1xyXG4gICAgICAgIGlmICghTnVtYmVyLmlzTmFOKHRoaXMucGVyaW9kIGFzIGFueSAlIDEpKVxyXG4gICAgICAgICAgICB0aGlzLl9wZXJpb2QgPSBwYXJzZUludCh0aGlzLnBlcmlvZCBhcyBzdHJpbmcpO1xyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBwZXJpb2RTdHIgPSB0aGlzLnBlcmlvZCBhcyBzdHJpbmc7XHJcbiAgICAgICAgICAgIC8vIHNwbGl0IHN0cmluZyBsaWtlICcxMDAzbXMnIHRvICcxMDAwJyBhbmQgJ21zJ1xyXG4gICAgICAgICAgICBjb25zdCB2YWx1ZXMgPSBwZXJpb2RTdHIucmVwbGFjZSgvXFwnL2csICcnKS5zcGxpdCgvKFswLTldKlxcLj9bMC05XSkvKTtcclxuICAgICAgICAgICAgdGhpcy5fcGVyaW9kID0gdmFsdWVzWzJdID09ICdzJyA/IHBhcnNlSW50KHZhbHVlc1sxXSkgKiAxMDAwIDogcGFyc2VJbnQodmFsdWVzWzFdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuX3JvdGF0aW9uVGltZXJTdWJzY3JpcHRpb24pXHJcbiAgICAgICAgICAgIHRoaXMuX3JvdGF0aW9uVGltZXJTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICB0aGlzLl9yb3RhdGlvblRpbWVyU3Vic2NyaXB0aW9uID0gdGhpcy5zZXRSb3RhdGlvblRpbWVyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjYWxjSGVpZ2h0KCkge1xyXG4gICAgICAgIGNvbnN0IG1heEggPSAgTWF0aC5tYXgobnVsbCwgLi4udGhpcy5yb3RhdGVJdGVtcy5tYXAoeCA9PiB4LnRlbXBsYXRlUmVmLmVsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5jbGllbnRIZWlnaHQpKTtcclxuICAgICAgICBpZiAoIXRoaXMuaGVpZ2h0KVxyXG4gICAgICAgICAgICB0aGlzLmhlaWdodCA9IG1heEggKyAncHgnO1xyXG4gICAgfVxyXG5cclxuLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuLy8tRXZlbnRzLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICAgIHByaXZhdGUgb25Sb3RhdGlvblN0YXJ0KCkge1xyXG4gICAgICAgIHRoaXMucm90YXRpb25TdGFydC5lbWl0KHRoaXMuX2FjdGl2ZUluZGV4KTtcclxuICAgIH1cclxuXHJcbiAgICBvblJvdGF0ZUVuZCgkZXZlbnQpIHtcclxuICAgICAgICBpZiAodGhpcy5fYWN0aXZlSW5kZXggPT0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLmNhcm91c2VsSW5uZXIubmF0aXZlRWxlbWVudC5zdHlsZS50cmFuc2l0aW9uID0gJ25vbmUnO1xyXG4gICAgICAgICAgICB0aGlzLmNhcm91c2VsSW5uZXIubmF0aXZlRWxlbWVudC5zdHlsZS50cmFuc2Zvcm0gPSAncm90YXRlWSgwZGVnKSc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucm90YXRpb25FbmQuZW1pdCh0aGlzLl9hY3RpdmVJbmRleCk7XHJcbiAgICB9XHJcblxyXG4vLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4vLy1TdHlsZS1WaXNpYmlsaXR5LUF2YWlsYWJpbGl0eS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4vLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gICAgZ2V0Q2Fyb3VzZWxTdHlsZSgpIHtcclxuICAgICAgICBjb25zdCB3aWR0aCA9IHRoaXMud2lkdGg7XHJcbiAgICAgICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XHJcbiAgICAgICAgY29uc3QgZGVwdGggPSB0aGlzLmRlcHRoO1xyXG4gICAgICAgIHJldHVybiB7IHdpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHQsIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVooLScgKyBkZXB0aCArICcpJyB9O1xyXG4gICAgfVxyXG5cclxuICAgIGdldEl0ZW1TdHlsZShpdGVtOiBSb3RhdGVDYXJvdXNlbEl0ZW1EaXJlY3RpdmUpIHtcclxuICAgICAgICBjb25zdCBkZXB0aCA9IHRoaXMuZGVwdGg7XHJcbiAgICAgICAgY29uc3Qgc3R5bGUgPSB7IHRyYW5zZm9ybTogJ3JvdGF0ZVkoJyArIGl0ZW0uYW5nbGUgKyAnZGVnKSB0cmFuc2xhdGVaKCcgKyBkZXB0aCArICcpJyB9O1xyXG4gICAgICAgIHJldHVybiBzdHlsZTtcclxuICAgIH1cclxuXHJcbi8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbi8vLU1ldGhvZHMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbi8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAgICBzZWxlY3RBdChpbmRleFBhdGg6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMuX3JvdGF0aW9uVGltZXJTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICB0aGlzLmNhcm91c2VsSW5uZXIubmF0aXZlRWxlbWVudC5zdHlsZS50cmFuc2Zvcm0gPSBgcm90YXRlWSgke2luZGV4UGF0aCAqIHRoaXMuX2FuZ2xlU3RlcH1kZWcpYDtcclxuICAgICAgICB0aGlzLl9yb3RhdGlvblRpbWVyU3Vic2NyaXB0aW9uID0gdGhpcy5zZXRSb3RhdGlvblRpbWVyKCk7XHJcbiAgICB9XHJcblxyXG4vLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4vLy1IZWxwLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4vLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gICAgc2V0Um90YXRpb25UaW1lcigpOiBTdWJzY3JpcHRpb24ge1xyXG4gICAgICAgIHJldHVybiB0aW1lcigwLCB0aGlzLl9wZXJpb2QpXHJcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKGk6IG51bWJlcikgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fYWN0aXZlSW5kZXggPSBpICUgdGhpcy5yb3RhdGVJdGVtcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBsZXQgYW5nbGU6IG51bWJlcjtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hY3RpdmVJbmRleCA9PSAxKVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2Fyb3VzZWxJbm5lci5uYXRpdmVFbGVtZW50LnN0eWxlLnRyYW5zaXRpb24gPSBgdHJhbnNmb3JtICR7dGhpcy5fcGVyaW9kIC8gMn1tcyBlYXNlLWluLW91dGA7XHJcbiAgICAgICAgICAgICAgICBpZiAoaSA+IDAgJiYgdGhpcy5fYWN0aXZlSW5kZXggPT0gMClcclxuICAgICAgICAgICAgICAgICAgICBhbmdsZSA9IHRoaXMucm90YXRlSXRlbXMubGVuZ3RoICogdGhpcy5fYW5nbGVTdGVwICogKHRoaXMuZGlyZWN0aW9uID09ICdmb3J3YXJkJyA/IC0xIDogMSk7XHJcbiAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgYW5nbGUgPSB0aGlzLl9hY3RpdmVJbmRleCAqIHRoaXMuX2FuZ2xlU3RlcCAqICh0aGlzLmRpcmVjdGlvbiA9PSAnZm9yd2FyZCcgPyAtMSA6IDEpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jYXJvdXNlbElubmVyLm5hdGl2ZUVsZW1lbnQuc3R5bGUudHJhbnNmb3JtID0gYHJvdGF0ZVkoJHthbmdsZX1kZWcpYDtcclxuICAgICAgICAgICAgICAgIHRoaXMub25Sb3RhdGlvblN0YXJ0KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==