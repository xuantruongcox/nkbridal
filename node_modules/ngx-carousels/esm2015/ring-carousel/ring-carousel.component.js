/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import { Component, Output, ContentChildren, QueryList, EventEmitter, ElementRef, ViewChildren, ViewChild, Input } from '@angular/core';
import { interval } from 'rxjs';
import { take, last, first } from 'rxjs/operators';
import { RingCarouselItemDirective } from './ring-carousel-item.directive';
export class RingCarouselComponent {
    constructor() {
        /**
         * Emit event of transition start
         */
        this.transitionStart = new EventEmitter();
        /**
         * Emit event of transition end
         */
        this.transitionEnd = new EventEmitter();
        /**
         * Color of transition rings
         */
        this.ringColor = 'white';
        /**
         * Count of transition rings
         */
        this.ringsCount = 12;
        /**
         * Rings delay in ms
         */
        this.ringsDelay = 130;
        /**
         * Ring expand/collapse duration in ms
         */
        this.ringsDuration = 800;
        /**
         * Expand carousel inner in transition
         */
        this.expandOnTransition = true;
        /**
         * Enable control on left and right part click
         */
        this.enableControl = true;
        /**
         * Stroke-width of each transition circle
         */
        this._strokeWidthStep = 0;
        this._isExpanding = false;
        this._isCollapsing = false;
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        this._activeItem = this.carouselItems.first;
        this._activeIndex = 0;
    }
    /**
     * @return {?}
     */
    ngOnChanges() {
        if (typeof this.ringsCount == 'string')
            this.ringsCount = parseInt((/** @type {?} */ (this.ringsCount)));
    }
    //***************************************************************************************************************
    //-Api-----------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * Turns the carousel to the item with the index path
     * @param {?} index
     * @param {?=} $event
     * @return {?}
     */
    selectAt(index, $event = null) {
        this._activeIndex = index;
        /** @type {?} */
        let x;
        /** @type {?} */
        let y;
        if ($event) {
            x = $event.layerX;
            y = $event.layerY;
        }
        else {
            y = this.carouselRef.nativeElement.clientHeight / 2;
            x = this.carouselRef.nativeElement.clientWidth / 2;
        }
        this.showRings(x, y, index);
    }
    /**
     * Select next carousel item
     * @param {?=} $event
     * @return {?}
     */
    next($event = null) {
        this._activeIndex = this._activeIndex + 1 < this.carouselItems.length ? this._activeIndex + 1 : 0;
        this.selectAt(this._activeIndex, $event);
    }
    /**
     * Select previous carousel item
     * @param {?=} $event
     * @return {?}
     */
    prev($event = null) {
        this._activeIndex = this._activeIndex - 1 >= 0 ? this._activeIndex - 1 : this.carouselItems.length - 1;
        this.selectAt(this._activeIndex, $event);
    }
    //***************************************************************************************************************
    //-Style-Visibility-Availability---------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * @param {?} x
     * @param {?} y
     * @param {?} index
     * @return {?}
     */
    showRings(x, y, index) {
        this.calcRingsWidth(x, y);
        this._cx = x;
        this._cy = y;
        this._isExpanding = true;
        /** @type {?} */
        const timer = interval(this.ringsDelay).pipe(take(this.ringsCount));
        timer.subscribe(timValue => {
            this.transitionStart.emit(index);
            /** @type {?} */
            const animation = this.expandAnimations.find((_, i) => timValue == i);
            animation.nativeElement.beginElement();
        });
        timer.pipe(last()).subscribe(_ => {
            interval(this.ringsDuration).pipe(first())
                .subscribe(_ => {
                this._activeItem = this.carouselItems.find((_, i) => i == index);
                this._isExpanding = false;
                this.hideRings();
            });
        });
    }
    /**
     * @return {?}
     */
    hideRings() {
        this._isCollapsing = true;
        /** @type {?} */
        const timer = interval(this.ringsDelay).pipe(take(this.ringsCount));
        timer.subscribe(i => {
            /** @type {?} */
            const animation = this.collapseAnimations.find((_, index) => i == index);
            animation.nativeElement.beginElement();
        });
        timer.pipe(last()).subscribe(_ => {
            interval(this.ringsDuration).pipe(first())
                .subscribe(_ => {
                this._isCollapsing = false;
                this.transitionEnd.emit(this._activeIndex);
            });
        });
    }
    //***************************************************************************************************************
    //-Help----------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * @param {?} x
     * @param {?} y
     * @return {?}
     */
    calcRingsWidth(x, y) {
        /** @type {?} */
        const x1 = this.carouselRef.nativeElement.clientWidth;
        /** @type {?} */
        const y1 = this.carouselRef.nativeElement.clientHeight;
        /** @type {?} */
        const isTop = y1 / 2 - y > 0;
        /** @type {?} */
        const isLeft = x1 / 2 - x > 0;
        /** @type {?} */
        let d;
        if (isTop && isLeft)
            d = Math.sqrt(Math.pow(y1 - y, 2) + Math.pow(x1 - x, 2));
        else if (isTop && !isLeft)
            d = Math.sqrt(Math.pow(y1 - y, 2) + Math.pow(x, 2));
        else if (!isTop && isLeft)
            d = Math.sqrt((Math.pow(y, 2) + Math.pow(x1 - x, 2)));
        else
            d = Math.sqrt((Math.pow(y, 2) + Math.pow(x, 2)));
        this._strokeWidthStep = d / (this.ringsCount - 1);
    }
}
RingCarouselComponent.decorators = [
    { type: Component, args: [{
                selector: 'ring-carousel',
                template: "<div #carousel class=\"carousel\">\r\n    <div class=\"carousel__inner\" [style.transform]=\"expandOnTransition && (_isExpanding || _isCollapsing) ? 'scale(1.2)' : 'none'\">\r\n        <ng-template [ngTemplateOutlet]=\"_activeItem.templateRef\"></ng-template>\r\n    </div>\r\n    <div *ngIf=\"enableControl\" class=\"control\">\r\n        <div class=\"left\" (click)=\"prev($event)\"></div>\r\n        <div class=\"right\" (click)=\"next($event)\"></div>\r\n    </div>\r\n    <div class=\"circles\" *ngIf=\"_isExpanding || _isCollapsing\">\r\n        <svg>\r\n            <ng-template ngFor [ngForOf]=\"' '.repeat(ringsCount).split('')\" let-i=\"index\">\r\n                <svg:circle [attr.cx]=\"_cx\" [attr.cy]=\"_cy\" [attr.r]=\"_strokeWidthStep * i + 1\" fill=\"none\" [attr.stroke]=\"ringColor\" stroke-width=\"0\">\r\n                    <animate #expandSvgAnimations attributeName=\"stroke-width\" begin=\"click\" [attr.dur]=\"ringsDuration + 'ms'\" from=\"0\" [attr.to]=\"_strokeWidthStep + 1\" fill=\"freeze\" />\r\n                    <animate #collapseSvgAnimations attributeName=\"stroke-width\" begin=\"click\" [attr.dur]=\"ringsDuration + 'ms'\" [attr.from]=\"_strokeWidthStep + 1\" to=\"0\" fill=\"freeze\" />\r\n                </svg:circle>\r\n            </ng-template>\r\n        </svg>\r\n    </div>\r\n</div>\r\n\r\n",
                styles: [":host{width:100%}.carousel{position:relative;overflow:hidden}.carousel__inner{transition:transform .8s;transition:transform .8s,-webkit-transform .8s;z-index:1}.control{display:flex;position:absolute;top:0;right:0;bottom:0;left:0;z-index:2}.control .left,.control .right{height:100%;flex:1;cursor:pointer}.circles{position:absolute;top:0;right:0;bottom:0;left:0;z-index:3}.circles svg{height:100%;width:100%}"]
            }] }
];
RingCarouselComponent.propDecorators = {
    carouselItems: [{ type: ContentChildren, args: [RingCarouselItemDirective,] }],
    carouselRef: [{ type: ViewChild, args: ['carousel',] }],
    expandAnimations: [{ type: ViewChildren, args: ['expandSvgAnimations',] }],
    collapseAnimations: [{ type: ViewChildren, args: ['collapseSvgAnimations',] }],
    transitionStart: [{ type: Output }],
    transitionEnd: [{ type: Output }],
    ringColor: [{ type: Input }],
    ringsCount: [{ type: Input }],
    ringsDelay: [{ type: Input }],
    ringsDuration: [{ type: Input }],
    expandOnTransition: [{ type: Input }],
    enableControl: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    RingCarouselComponent.prototype.carouselItems;
    /** @type {?} */
    RingCarouselComponent.prototype.carouselRef;
    /** @type {?} */
    RingCarouselComponent.prototype.expandAnimations;
    /** @type {?} */
    RingCarouselComponent.prototype.collapseAnimations;
    /**
     * Emit event of transition start
     * @type {?}
     */
    RingCarouselComponent.prototype.transitionStart;
    /**
     * Emit event of transition end
     * @type {?}
     */
    RingCarouselComponent.prototype.transitionEnd;
    /**
     * Color of transition rings
     * @type {?}
     */
    RingCarouselComponent.prototype.ringColor;
    /**
     * Count of transition rings
     * @type {?}
     */
    RingCarouselComponent.prototype.ringsCount;
    /**
     * Rings delay in ms
     * @type {?}
     */
    RingCarouselComponent.prototype.ringsDelay;
    /**
     * Ring expand/collapse duration in ms
     * @type {?}
     */
    RingCarouselComponent.prototype.ringsDuration;
    /**
     * Expand carousel inner in transition
     * @type {?}
     */
    RingCarouselComponent.prototype.expandOnTransition;
    /**
     * Enable control on left and right part click
     * @type {?}
     */
    RingCarouselComponent.prototype.enableControl;
    /** @type {?} */
    RingCarouselComponent.prototype._activeIndex;
    /** @type {?} */
    RingCarouselComponent.prototype._activeItem;
    /**
     * Stroke-width of each transition circle
     * @type {?}
     */
    RingCarouselComponent.prototype._strokeWidthStep;
    /** @type {?} */
    RingCarouselComponent.prototype._isExpanding;
    /** @type {?} */
    RingCarouselComponent.prototype._isCollapsing;
    /** @type {?} */
    RingCarouselComponent.prototype._cx;
    /** @type {?} */
    RingCarouselComponent.prototype._cy;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmluZy1jYXJvdXNlbC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtY2Fyb3VzZWxzLyIsInNvdXJjZXMiOlsicmluZy1jYXJvdXNlbC9yaW5nLWNhcm91c2VsLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNILFNBQVMsRUFBRSxNQUFNLEVBQUUsZUFBZSxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQW9CLFVBQVUsRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFDNUgsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNoQyxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVuRCxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQU8zRSxNQUFNLE9BQU8scUJBQXFCO0lBTGxDOzs7O1FBY2Msb0JBQWUsR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDOzs7O1FBRTdDLGtCQUFhLEdBQUcsSUFBSSxZQUFZLEVBQVUsQ0FBQzs7OztRQUU1QyxjQUFTLEdBQVcsT0FBTyxDQUFDOzs7O1FBRTVCLGVBQVUsR0FBVyxFQUFFLENBQUM7Ozs7UUFFeEIsZUFBVSxHQUFXLEdBQUcsQ0FBQzs7OztRQUV6QixrQkFBYSxHQUFXLEdBQUcsQ0FBQzs7OztRQUU1Qix1QkFBa0IsR0FBWSxJQUFJLENBQUM7Ozs7UUFFbkMsa0JBQWEsR0FBWSxJQUFJLENBQUM7Ozs7UUFLdkMscUJBQWdCLEdBQVcsQ0FBQyxDQUFDO1FBQzdCLGlCQUFZLEdBQVksS0FBSyxDQUFDO1FBQzlCLGtCQUFhLEdBQVksS0FBSyxDQUFDO0lBMEduQyxDQUFDOzs7O0lBckdHLGtCQUFrQjtRQUNkLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUM7UUFDNUMsSUFB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QUUsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3JELElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ3RELENBQUM7OztZQTNJSixTQUFTLFNBQUM7Z0JBQ1AsUUFBUSxFQUFFLGVBQWU7Z0JBQ3pCLHUwQ0FBNkM7O2FBRWhEOzs7NEJBR0ksZUFBZSxTQUFDLHlCQUF5QjswQkFFekMsU0FBUyxTQUFDLFVBQVU7K0JBQ3BCLFlBQVksU0FBQyxxQkFBcUI7aUNBQ2xDLFlBQVksU0FBQyx1QkFBdUI7OEJBR3BDLE1BQU07NEJBRU4sTUFBTTt3QkFFTixLQUFLO3lCQUVMLEtBQUs7eUJBRUwsS0FBSzs0QkFFTCxLQUFLO2lDQUVMLEtBQUs7NEJBRUwsS0FBSzs7OztJQXJCTiw4Q0FBZ0c7O0lBRWhHLDRDQUErQzs7SUFDL0MsaURBQTZFOztJQUM3RSxtREFBaUY7Ozs7O0lBR2pGLGdEQUF1RDs7Ozs7SUFFdkQsOENBQXFEOzs7OztJQUVyRCwwQ0FBcUM7Ozs7O0lBRXJDLDJDQUFpQzs7Ozs7SUFFakMsMkNBQWtDOzs7OztJQUVsQyw4Q0FBcUM7Ozs7O0lBRXJDLG1EQUE0Qzs7Ozs7SUFFNUMsOENBQXVDOztJQUV2Qyw2Q0FBNkI7O0lBQzdCLDRDQUF1Qzs7Ozs7SUFFdkMsaURBQTZCOztJQUM3Qiw2Q0FBOEI7O0lBQzlCLDhDQUErQjs7SUFFL0Isb0NBQVk7O0lBQ1osb0NBQVkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gICAgQ29tcG9uZW50LCBPdXRwdXQsIENvbnRlbnRDaGlsZHJlbiwgUXVlcnlMaXN0LCBFdmVudEVtaXR0ZXIsIEFmdGVyQ29udGVudEluaXQsIEVsZW1lbnRSZWYsIFZpZXdDaGlsZHJlbiwgVmlld0NoaWxkLCBJbnB1dCwgT25DaGFuZ2VzXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IGludGVydmFsIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IHRha2UsIGxhc3QsIGZpcnN0IH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuaW1wb3J0IHsgUmluZ0Nhcm91c2VsSXRlbURpcmVjdGl2ZSB9IGZyb20gJy4vcmluZy1jYXJvdXNlbC1pdGVtLmRpcmVjdGl2ZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICAgIHNlbGVjdG9yOiAncmluZy1jYXJvdXNlbCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vcmluZy1jYXJvdXNlbC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi9yaW5nLWNhcm91c2VsLmNvbXBvbmVudC5zY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIFJpbmdDYXJvdXNlbENvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyQ29udGVudEluaXQsIE9uQ2hhbmdlcyB7XHJcblxyXG4gICAgQENvbnRlbnRDaGlsZHJlbihSaW5nQ2Fyb3VzZWxJdGVtRGlyZWN0aXZlKSBjYXJvdXNlbEl0ZW1zOiBRdWVyeUxpc3Q8UmluZ0Nhcm91c2VsSXRlbURpcmVjdGl2ZT47XHJcblxyXG4gICAgQFZpZXdDaGlsZCgnY2Fyb3VzZWwnKSBjYXJvdXNlbFJlZjogRWxlbWVudFJlZjtcclxuICAgIEBWaWV3Q2hpbGRyZW4oJ2V4cGFuZFN2Z0FuaW1hdGlvbnMnKSBleHBhbmRBbmltYXRpb25zOiBRdWVyeUxpc3Q8RWxlbWVudFJlZj47XHJcbiAgICBAVmlld0NoaWxkcmVuKCdjb2xsYXBzZVN2Z0FuaW1hdGlvbnMnKSBjb2xsYXBzZUFuaW1hdGlvbnM6IFF1ZXJ5TGlzdDxFbGVtZW50UmVmPjtcclxuXHJcbiAgICAvKiogRW1pdCBldmVudCBvZiB0cmFuc2l0aW9uIHN0YXJ0ICovXHJcbiAgICBAT3V0cHV0KCkgdHJhbnNpdGlvblN0YXJ0ID0gbmV3IEV2ZW50RW1pdHRlcjxudW1iZXI+KCk7XHJcbiAgICAvKiogRW1pdCBldmVudCBvZiB0cmFuc2l0aW9uIGVuZCAqL1xyXG4gICAgQE91dHB1dCgpIHRyYW5zaXRpb25FbmQgPSBuZXcgRXZlbnRFbWl0dGVyPG51bWJlcj4oKTtcclxuICAgIC8qKiBDb2xvciBvZiB0cmFuc2l0aW9uIHJpbmdzICovXHJcbiAgICBASW5wdXQoKSByaW5nQ29sb3I6IHN0cmluZyA9ICd3aGl0ZSc7XHJcbiAgICAvKiogQ291bnQgb2YgdHJhbnNpdGlvbiByaW5ncyAqL1xyXG4gICAgQElucHV0KCkgcmluZ3NDb3VudDogbnVtYmVyID0gMTI7XHJcbiAgICAvKiogUmluZ3MgZGVsYXkgaW4gbXMgKi9cclxuICAgIEBJbnB1dCgpIHJpbmdzRGVsYXk6IG51bWJlciA9IDEzMDtcclxuICAgIC8qKiBSaW5nIGV4cGFuZC9jb2xsYXBzZSBkdXJhdGlvbiBpbiBtcyAqL1xyXG4gICAgQElucHV0KCkgcmluZ3NEdXJhdGlvbjogbnVtYmVyID0gODAwO1xyXG4gICAgLyoqIEV4cGFuZCBjYXJvdXNlbCBpbm5lciBpbiB0cmFuc2l0aW9uICovXHJcbiAgICBASW5wdXQoKSBleHBhbmRPblRyYW5zaXRpb246IGJvb2xlYW4gPSB0cnVlO1xyXG4gICAgLyoqIEVuYWJsZSBjb250cm9sIG9uIGxlZnQgYW5kIHJpZ2h0IHBhcnQgY2xpY2sgKi9cclxuICAgIEBJbnB1dCgpIGVuYWJsZUNvbnRyb2w6IGJvb2xlYW4gPSB0cnVlO1xyXG5cclxuICAgIHByaXZhdGUgX2FjdGl2ZUluZGV4OiBudW1iZXI7XHJcbiAgICBfYWN0aXZlSXRlbTogUmluZ0Nhcm91c2VsSXRlbURpcmVjdGl2ZTtcclxuICAgIC8qKiBTdHJva2Utd2lkdGggb2YgZWFjaCB0cmFuc2l0aW9uIGNpcmNsZSAqL1xyXG4gICAgX3N0cm9rZVdpZHRoU3RlcDogbnVtYmVyID0gMDtcclxuICAgIF9pc0V4cGFuZGluZzogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgX2lzQ29sbGFwc2luZzogYm9vbGVhbiA9IGZhbHNlO1xyXG5cclxuICAgIF9jeDogbnVtYmVyO1xyXG4gICAgX2N5OiBudW1iZXI7XHJcblxyXG4gICAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xyXG4gICAgICAgIHRoaXMuX2FjdGl2ZUl0ZW0gPSB0aGlzLmNhcm91c2VsSXRlbXMuZmlyc3Q7XHJcbiAgICAgICAgdGhpcy5fYWN0aXZlSW5kZXggPSAwO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25DaGFuZ2VzKCkge1xyXG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5yaW5nc0NvdW50ID09ICdzdHJpbmcnKVxyXG4gICAgICAgICAgICB0aGlzLnJpbmdzQ291bnQgPSBwYXJzZUludCh0aGlzLnJpbmdzQ291bnQgYXMgc3RyaW5nKTtcclxuICAgIH1cclxuXHJcbi8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbi8vLUFwaS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbi8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAgICAvKiogVHVybnMgdGhlIGNhcm91c2VsIHRvIHRoZSBpdGVtIHdpdGggdGhlIGluZGV4IHBhdGggKi9cclxuICAgIHB1YmxpYyBzZWxlY3RBdChpbmRleDogbnVtYmVyLCAkZXZlbnQgPSBudWxsKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5fYWN0aXZlSW5kZXggPSBpbmRleDtcclxuICAgICAgICBsZXQgeDogbnVtYmVyLCB5OiBudW1iZXI7XHJcbiAgICAgICAgaWYgKCRldmVudCkge1xyXG4gICAgICAgICAgICB4ID0gJGV2ZW50LmxheWVyWDtcclxuICAgICAgICAgICAgeSA9ICRldmVudC5sYXllclk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB5ID0gdGhpcy5jYXJvdXNlbFJlZi5uYXRpdmVFbGVtZW50LmNsaWVudEhlaWdodCAvIDI7XHJcbiAgICAgICAgICAgIHggPSB0aGlzLmNhcm91c2VsUmVmLm5hdGl2ZUVsZW1lbnQuY2xpZW50V2lkdGggLyAyO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNob3dSaW5ncyh4LCB5LCBpbmRleCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIFNlbGVjdCBuZXh0IGNhcm91c2VsIGl0ZW0gICovXHJcbiAgICBwdWJsaWMgbmV4dCgkZXZlbnQgPSBudWxsKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5fYWN0aXZlSW5kZXggPSB0aGlzLl9hY3RpdmVJbmRleCArIDEgPCB0aGlzLmNhcm91c2VsSXRlbXMubGVuZ3RoID8gdGhpcy5fYWN0aXZlSW5kZXggKyAxIDogMDtcclxuICAgICAgICB0aGlzLnNlbGVjdEF0KHRoaXMuX2FjdGl2ZUluZGV4LCAkZXZlbnQpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiBTZWxlY3QgcHJldmlvdXMgY2Fyb3VzZWwgaXRlbSAqL1xyXG4gICAgcHVibGljIHByZXYoJGV2ZW50ID0gbnVsbCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuX2FjdGl2ZUluZGV4ID0gdGhpcy5fYWN0aXZlSW5kZXggLSAxID49IDAgPyB0aGlzLl9hY3RpdmVJbmRleCAtIDEgOiB0aGlzLmNhcm91c2VsSXRlbXMubGVuZ3RoIC0gMTtcclxuICAgICAgICB0aGlzLnNlbGVjdEF0KHRoaXMuX2FjdGl2ZUluZGV4LCAkZXZlbnQpO1xyXG4gICAgfVxyXG5cclxuLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuLy8tU3R5bGUtVmlzaWJpbGl0eS1BdmFpbGFiaWxpdHktLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICAgIHNob3dSaW5ncyh4OiBudW1iZXIsIHk6IG51bWJlciwgaW5kZXg6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMuY2FsY1JpbmdzV2lkdGgoeCwgeSk7XHJcbiAgICAgICAgdGhpcy5fY3ggPSB4O1xyXG4gICAgICAgIHRoaXMuX2N5ID0geTtcclxuICAgICAgICB0aGlzLl9pc0V4cGFuZGluZyA9IHRydWU7XHJcbiAgICAgICAgY29uc3QgdGltZXIgPSBpbnRlcnZhbCh0aGlzLnJpbmdzRGVsYXkpLnBpcGUodGFrZSh0aGlzLnJpbmdzQ291bnQpKTtcclxuICAgICAgICB0aW1lci5zdWJzY3JpYmUodGltVmFsdWUgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnRyYW5zaXRpb25TdGFydC5lbWl0KGluZGV4KTtcclxuICAgICAgICAgICAgY29uc3QgYW5pbWF0aW9uID0gdGhpcy5leHBhbmRBbmltYXRpb25zLmZpbmQoKF8sIGkpID0+IHRpbVZhbHVlID09IGkpO1xyXG4gICAgICAgICAgICBhbmltYXRpb24ubmF0aXZlRWxlbWVudC5iZWdpbkVsZW1lbnQoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aW1lci5waXBlKGxhc3QoKSkuc3Vic2NyaWJlKF8gPT4ge1xyXG4gICAgICAgICAgICBpbnRlcnZhbCh0aGlzLnJpbmdzRHVyYXRpb24pLnBpcGUoZmlyc3QoKSlcclxuICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUoXyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWN0aXZlSXRlbSA9IHRoaXMuY2Fyb3VzZWxJdGVtcy5maW5kKChfLCBpKSA9PiBpID09IGluZGV4KTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9pc0V4cGFuZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGlkZVJpbmdzKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBoaWRlUmluZ3MoKSB7XHJcbiAgICAgICAgdGhpcy5faXNDb2xsYXBzaW5nID0gdHJ1ZTtcclxuICAgICAgICBjb25zdCB0aW1lciA9IGludGVydmFsKHRoaXMucmluZ3NEZWxheSkucGlwZSh0YWtlKHRoaXMucmluZ3NDb3VudCkpO1xyXG4gICAgICAgIHRpbWVyLnN1YnNjcmliZShpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgYW5pbWF0aW9uID0gdGhpcy5jb2xsYXBzZUFuaW1hdGlvbnMuZmluZCgoXywgaW5kZXgpID0+IGkgPT0gaW5kZXgpO1xyXG4gICAgICAgICAgICBhbmltYXRpb24ubmF0aXZlRWxlbWVudC5iZWdpbkVsZW1lbnQoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aW1lci5waXBlKGxhc3QoKSkuc3Vic2NyaWJlKF8gPT4ge1xyXG4gICAgICAgICAgICBpbnRlcnZhbCh0aGlzLnJpbmdzRHVyYXRpb24pLnBpcGUoZmlyc3QoKSlcclxuICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUoXyA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5faXNDb2xsYXBzaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2l0aW9uRW5kLmVtaXQodGhpcy5fYWN0aXZlSW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4vLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4vLy1IZWxwLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4vLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gICAgY2FsY1JpbmdzV2lkdGgoeDogbnVtYmVyLCB5OiBudW1iZXIpIHtcclxuICAgICAgICBjb25zdCB4MSA9IHRoaXMuY2Fyb3VzZWxSZWYubmF0aXZlRWxlbWVudC5jbGllbnRXaWR0aDtcclxuICAgICAgICBjb25zdCB5MSA9IHRoaXMuY2Fyb3VzZWxSZWYubmF0aXZlRWxlbWVudC5jbGllbnRIZWlnaHQ7XHJcbiAgICAgICAgY29uc3QgaXNUb3AgPSB5MSAvIDIgLSB5ID4gMDtcclxuICAgICAgICBjb25zdCBpc0xlZnQgPSB4MSAvIDIgLSB4ID4gMDtcclxuXHJcbiAgICAgICAgbGV0IGQ6IG51bWJlcjtcclxuICAgICAgICBpZiAoaXNUb3AgJiYgaXNMZWZ0KVxyXG4gICAgICAgICAgICBkID0gTWF0aC5zcXJ0KE1hdGgucG93KHkxIC0geSwgMikgKyBNYXRoLnBvdyh4MSAtIHgsIDIpKTtcclxuICAgICAgICBlbHNlIGlmIChpc1RvcCAmJiAhaXNMZWZ0KVxyXG4gICAgICAgICAgICBkID0gTWF0aC5zcXJ0KE1hdGgucG93KHkxIC0geSwgMikgKyBNYXRoLnBvdyh4LCAyKSk7XHJcbiAgICAgICAgZWxzZSBpZiAoIWlzVG9wICYmIGlzTGVmdClcclxuICAgICAgICAgICAgZCA9IE1hdGguc3FydCgoTWF0aC5wb3coeSwgMikgKyBNYXRoLnBvdyh4MSAtIHgsIDIpKSk7XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICBkID0gTWF0aC5zcXJ0KChNYXRoLnBvdyh5LCAyKSArIE1hdGgucG93KHgsIDIpKSk7XHJcbiAgICAgICAgdGhpcy5fc3Ryb2tlV2lkdGhTdGVwID0gZCAvICh0aGlzLnJpbmdzQ291bnQgLSAxKTtcclxuICAgIH1cclxuXHJcbn1cclxuIl19