/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ContentChildren, QueryList, ViewChild, ElementRef } from '@angular/core';
import { timer } from 'rxjs';
import { RotateCarouselItemDirective } from './rotate-carousel-item.directive';
/** @type {?} */
const DEFAULT_WIDTH = '300px';
/** @type {?} */
const DEFAULT_HEIGHT = '200px';
/** @type {?} */
const DEFAULT_DEPTH = '510px';
/** @type {?} */
const DEFAULT_PERIOD = 3500;
/** @type {?} */
const FULL_ANGLE = 360;
export class RotateCarouselComponent {
    constructor() {
        /**
         * Emit event of rotation start
         */
        this.rotationStart = new EventEmitter();
        /**
         * Emit event of rotation end
         */
        this.rotationEnd = new EventEmitter();
        /**
         * Width of content in carousel item
         */
        this.width = DEFAULT_WIDTH;
        /**
         * Height of content in carousel item
         */
        this.height = DEFAULT_HEIGHT;
        /**
         * Depth of the center of carousel
         */
        this.depth = DEFAULT_DEPTH;
        /**
         * Period of carousel rotation
         */
        this.period = DEFAULT_PERIOD;
        /**
         * Direction of rotation
         */
        this.direction = 'forward';
        this._activeIndex = 0;
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        this.calcItemsAngle();
        this.setupRotation();
        //this.calcHeight();
    }
    /**
     * @return {?}
     */
    ngOnChanges() {
        this.setupRotation();
        //this.calcHeight();
    }
    //***************************************************************************************************************
    //-Setup---------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * @return {?}
     */
    calcItemsAngle() {
        this._angleStep = FULL_ANGLE / this.rotateItems.length;
        /** @type {?} */
        let angle = 0;
        this.rotateItems.forEach(x => {
            x.angle = angle;
            angle += this._angleStep;
        });
    }
    /**
     * @return {?}
     */
    setupRotation() {
        if (!Number.isNaN((/** @type {?} */ (this.period)) % 1))
            this._period = parseInt((/** @type {?} */ (this.period)));
        else {
            /** @type {?} */
            const periodStr = (/** @type {?} */ (this.period));
            // split string like '1003ms' to '1000' and 'ms'
            /** @type {?} */
            const values = periodStr.replace(/\'/g, '').split(/([0-9]*\.?[0-9])/);
            this._period = values[2] == 's' ? parseInt(values[1]) * 1000 : parseInt(values[1]);
        }
        if (this._rotationTimerSubscription)
            this._rotationTimerSubscription.unsubscribe();
        this._rotationTimerSubscription = this.setRotationTimer();
    }
    /**
     * @return {?}
     */
    calcHeight() {
        /** @type {?} */
        const maxH = Math.max(null, ...this.rotateItems.map(x => x.templateRef.elementRef.nativeElement.clientHeight));
        if (!this.height)
            this.height = maxH + 'px';
    }
    //***************************************************************************************************************
    //-Events--------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * @return {?}
     */
    onRotationStart() {
        this.rotationStart.emit(this._activeIndex);
    }
    /**
     * @param {?} $event
     * @return {?}
     */
    onRotateEnd($event) {
        if (this._activeIndex == 0) {
            this.carouselInner.nativeElement.style.transition = 'none';
            this.carouselInner.nativeElement.style.transform = 'rotateY(0deg)';
        }
        this.rotationEnd.emit(this._activeIndex);
    }
    //***************************************************************************************************************
    //-Style-Visibility-Availability---------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * @return {?}
     */
    getCarouselStyle() {
        /** @type {?} */
        const width = this.width;
        /** @type {?} */
        const height = this.height;
        /** @type {?} */
        const depth = this.depth;
        return { width: width, height: height, transform: 'translateZ(-' + depth + ')' };
    }
    /**
     * @param {?} item
     * @return {?}
     */
    getItemStyle(item) {
        /** @type {?} */
        const depth = this.depth;
        /** @type {?} */
        const style = { transform: 'rotateY(' + item.angle + 'deg) translateZ(' + depth + ')' };
        return style;
    }
    //***************************************************************************************************************
    //-Methods-------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * @param {?} indexPath
     * @return {?}
     */
    selectAt(indexPath) {
        this._rotationTimerSubscription.unsubscribe();
        this.carouselInner.nativeElement.style.transform = `rotateY(${indexPath * this._angleStep}deg)`;
        this._rotationTimerSubscription = this.setRotationTimer();
    }
    //***************************************************************************************************************
    //-Help----------------------------------------------------------------------------------------------------------
    //***************************************************************************************************************
    /**
     * @return {?}
     */
    setRotationTimer() {
        return timer(0, this._period)
            .subscribe((i) => {
            this._activeIndex = i % this.rotateItems.length;
            /** @type {?} */
            let angle;
            if (this._activeIndex == 1)
                this.carouselInner.nativeElement.style.transition = `transform ${this._period / 2}ms ease-in-out`;
            if (i > 0 && this._activeIndex == 0)
                angle = this.rotateItems.length * this._angleStep * (this.direction == 'forward' ? -1 : 1);
            else
                angle = this._activeIndex * this._angleStep * (this.direction == 'forward' ? -1 : 1);
            this.carouselInner.nativeElement.style.transform = `rotateY(${angle}deg)`;
            this.onRotationStart();
        });
    }
}
RotateCarouselComponent.decorators = [
    { type: Component, args: [{
                selector: 'rotate-carousel',
                template: "<figure class=\"carousel\">\r\n    <div class=\"carousel__content\" [ngStyle]=\"getCarouselStyle()\">\r\n        <div #carouselInner class=\"carousel__inner\" (transitionend)=\"onRotateEnd($event)\">\r\n            <ng-template ngFor let-item [ngForOf]=\"rotateItems\">\r\n                <div class=\"carousel__item\" [ngStyle]=\"getItemStyle(item)\">\r\n                    <ng-template [ngTemplateOutlet]=\"item.templateRef\"></ng-template>\r\n                </div>\r\n            </ng-template>\r\n        </div>\r\n    </div>\r\n</figure>",
                styles: [":host{width:100%}.carousel{display:flex;justify-content:center;-webkit-perspective:1000px;perspective:1000px}.carousel__content{-webkit-transform:translateZ(-40vw);transform:translateZ(-40vw);-webkit-transform-style:preserve-3d;transform-style:preserve-3d}.carousel__inner{height:100%;-webkit-transform-style:preserve-3d;transform-style:preserve-3d}.carousel__item{display:flex;align-items:center;position:absolute;height:100%;width:100%}.carousel__item img{height:100%;width:100%;-o-object-fit:cover;object-fit:cover;-o-object-position:center;object-position:center;border-radius:15px}"]
            }] }
];
RotateCarouselComponent.propDecorators = {
    rotateItems: [{ type: ContentChildren, args: [RotateCarouselItemDirective,] }],
    carouselInner: [{ type: ViewChild, args: ['carouselInner',] }],
    rotationStart: [{ type: Output }],
    rotationEnd: [{ type: Output }],
    width: [{ type: Input }],
    height: [{ type: Input }],
    depth: [{ type: Input }],
    period: [{ type: Input }],
    direction: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    RotateCarouselComponent.prototype.rotateItems;
    /** @type {?} */
    RotateCarouselComponent.prototype.carouselInner;
    /**
     * Emit event of rotation start
     * @type {?}
     */
    RotateCarouselComponent.prototype.rotationStart;
    /**
     * Emit event of rotation end
     * @type {?}
     */
    RotateCarouselComponent.prototype.rotationEnd;
    /**
     * Width of content in carousel item
     * @type {?}
     */
    RotateCarouselComponent.prototype.width;
    /**
     * Height of content in carousel item
     * @type {?}
     */
    RotateCarouselComponent.prototype.height;
    /**
     * Depth of the center of carousel
     * @type {?}
     */
    RotateCarouselComponent.prototype.depth;
    /**
     * Period of carousel rotation
     * @type {?}
     */
    RotateCarouselComponent.prototype.period;
    /**
     * Direction of rotation
     * @type {?}
     */
    RotateCarouselComponent.prototype.direction;
    /** @type {?} */
    RotateCarouselComponent.prototype._period;
    /** @type {?} */
    RotateCarouselComponent.prototype._angleStep;
    /** @type {?} */
    RotateCarouselComponent.prototype._rotationTimerSubscription;
    /** @type {?} */
    RotateCarouselComponent.prototype._activeIndex;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm90YXRlLWNhcm91c2VsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1jYXJvdXNlbHMvIiwic291cmNlcyI6WyJyb3RhdGUtY2Fyb3VzZWwvcm90YXRlLWNhcm91c2VsLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNILFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxlQUFlLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBRTVGLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxLQUFLLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBRTNDLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLGtDQUFrQyxDQUFDOztNQUV6RSxhQUFhLEdBQUcsT0FBTzs7TUFDdkIsY0FBYyxHQUFHLE9BQU87O01BQ3hCLGFBQWEsR0FBRyxPQUFPOztNQUN2QixjQUFjLEdBQUcsSUFBSTs7TUFFckIsVUFBVSxHQUFHLEdBQUc7QUFPdEIsTUFBTSxPQUFPLHVCQUF1QjtJQUxwQzs7OztRQVdjLGtCQUFhLEdBQUcsSUFBSSxZQUFZLEVBQVUsQ0FBQzs7OztRQUUzQyxnQkFBVyxHQUFHLElBQUksWUFBWSxFQUFVLENBQUM7Ozs7UUFFMUMsVUFBSyxHQUFXLGFBQWEsQ0FBQzs7OztRQUU5QixXQUFNLEdBQVcsY0FBYyxDQUFDOzs7O1FBRWhDLFVBQUssR0FBVyxhQUFhLENBQUM7Ozs7UUFFOUIsV0FBTSxHQUFvQixjQUFjLENBQUM7Ozs7UUFFekMsY0FBUyxHQUEwQixTQUFTLENBQUM7UUFLOUMsaUJBQVksR0FBVyxDQUFDLENBQUM7SUF1R3JDLENBQUM7Ozs7SUFyR0csa0JBQWtCO1FBQ2QsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUNyQixvQkFBb0I7SUFDeEIsQ0FBQzs7OztJQUVELFdBQVc7UUFDUCxJQUFJLENB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LEtBQUssR0FBRyxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxJQUFJLENBQUMsU0FBUyxJQUFJLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3pGLElBQUksQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxTQUFTLEdBQUcsV0FBVyxLQUFLLE1BQU0sQ0FBQztZQUMxRSxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDM0IsQ0FBQyxDQUFDLENBQUM7SUFDWCxDQUFDOzs7WUFsSUosU0FBUyxTQUFDO2dCQUNQLFFBQVEsRUFBRSxpQkFBaUI7Z0JBQzNCLDRpQkFBK0M7O2FBRWxEOzs7MEJBR0ksZUFBZSxTQUFDLDJCQUEyQjs0QkFDM0MsU0FBUyxTQUFDLGVBQWU7NEJBR3pCLE1BQU07MEJBRU4sTUFBTTtvQkFFTixLQUFLO3FCQUVMLEtBQUs7b0JBRUwsS0FBSztxQkFFTCxLQUFLO3dCQUVMLEtBQUs7Ozs7SUFoQk4sOENBQWtHOztJQUNsRyxnREFBc0Q7Ozs7O0lBR3RELGdEQUFxRDs7Ozs7SUFFckQsOENBQW1EOzs7OztJQUVuRCx3Q0FBdUM7Ozs7O0lBRXZDLHlDQUF5Qzs7Ozs7SUFFekMsd0NBQXVDOzs7OztJQUV2Qyx5Q0FBa0Q7Ozs7O0lBRWxELDRDQUFzRDs7SUFFdEQsMENBQXdCOztJQUN4Qiw2Q0FBMkI7O0lBQzNCLDZEQUFpRDs7SUFDakQsK0NBQWlDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICAgIENvbXBvbmVudCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBDb250ZW50Q2hpbGRyZW4sIFF1ZXJ5TGlzdCwgVmlld0NoaWxkLCBFbGVtZW50UmVmLFxyXG4gICAgQWZ0ZXJDb250ZW50SW5pdCwgT25DaGFuZ2VzXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IHRpbWVyLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcclxuXHJcbmltcG9ydCB7IFJvdGF0ZUNhcm91c2VsSXRlbURpcmVjdGl2ZSB9IGZyb20gJy4vcm90YXRlLWNhcm91c2VsLWl0ZW0uZGlyZWN0aXZlJztcclxuXHJcbmNvbnN0IERFRkFVTFRfV0lEVEggPSAnMzAwcHgnO1xyXG5jb25zdCBERUZBVUxUX0hFSUdIVCA9ICcyMDBweCc7XHJcbmNvbnN0IERFRkFVTFRfREVQVEggPSAnNTEwcHgnO1xyXG5jb25zdCBERUZBVUxUX1BFUklPRCA9IDM1MDA7XHJcblxyXG5jb25zdCBGVUxMX0FOR0xFID0gMzYwO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ3JvdGF0ZS1jYXJvdXNlbCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vcm90YXRlLWNhcm91c2VsLmNvbXBvbmVudC5odG1sJyxcclxuICAgIHN0eWxlVXJsczogWycuL3JvdGF0ZS1jYXJvdXNlbC5jb21wb25lbnQuc2NzcyddXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBSb3RhdGVDYXJvdXNlbENvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyQ29udGVudEluaXQsIE9uQ2hhbmdlcyB7XHJcblxyXG4gICAgQENvbnRlbnRDaGlsZHJlbihSb3RhdGVDYXJvdXNlbEl0ZW1EaXJlY3RpdmUpIHJvdGF0ZUl0ZW1zOiBRdWVyeUxpc3Q8Um90YXRlQ2Fyb3VzZWxJdGVtRGlyZWN0aXZlPjtcclxuICAgIEBWaWV3Q2hpbGQoJ2Nhcm91c2VsSW5uZXInKSBjYXJvdXNlbElubmVyOiBFbGVtZW50UmVmO1xyXG5cclxuICAgIC8qKiBFbWl0IGV2ZW50IG9mIHJvdGF0aW9uIHN0YXJ0ICovXHJcbiAgICBAT3V0cHV0KCkgcm90YXRpb25TdGFydCA9IG5ldyBFdmVudEVtaXR0ZXI8bnVtYmVyPigpO1xyXG4gICAgLyoqIEVtaXQgZXZlbnQgb2Ygcm90YXRpb24gZW5kICovXHJcbiAgICBAT3V0cHV0KCkgcm90YXRpb25FbmQgPSBuZXcgRXZlbnRFbWl0dGVyPG51bWJlcj4oKTtcclxuICAgIC8qKiBXaWR0aCBvZiBjb250ZW50IGluIGNhcm91c2VsIGl0ZW0gKi9cclxuICAgIEBJbnB1dCgpIHdpZHRoOiBzdHJpbmcgPSBERUZBVUxUX1dJRFRIO1xyXG4gICAgLyoqIEhlaWdodCBvZiBjb250ZW50IGluIGNhcm91c2VsIGl0ZW0gKi9cclxuICAgIEBJbnB1dCgpIGhlaWdodDogc3RyaW5nID0gREVGQVVMVF9IRUlHSFQ7XHJcbiAgICAvKiogRGVwdGggb2YgdGhlIGNlbnRlciBvZiBjYXJvdXNlbCAqL1xyXG4gICAgQElucHV0KCkgZGVwdGg6IHN0cmluZyA9IERFRkFVTFRfREVQVEg7XHJcbiAgICAvKiogUGVyaW9kIG9mIGNhcm91c2VsIHJvdGF0aW9uICovXHJcbiAgICBASW5wdXQoKSBwZXJpb2Q6IG51bWJlciB8IHN0cmluZyA9IERFRkFVTFRfUEVSSU9EO1xyXG4gICAgLyoqIERpcmVjdGlvbiBvZiByb3RhdGlvbiAqL1xyXG4gICAgQElucHV0KCkgZGlyZWN0aW9uOiAnZm9yd2FyZCcgfCAncmV2ZXJzZScgPSAnZm9yd2FyZCc7XHJcblxyXG4gICAgcHJpdmF0ZSBfcGVyaW9kOiBudW1iZXI7XHJcbiAgICBwcml2YXRlIF9hbmdsZVN0ZXA6IG51bWJlcjtcclxuICAgIHByaXZhdGUgX3JvdGF0aW9uVGltZXJTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcclxuICAgIHByaXZhdGUgX2FjdGl2ZUluZGV4OiBudW1iZXIgPSAwO1xyXG5cclxuICAgIG5nQWZ0ZXJDb250ZW50SW5pdCgpIHtcclxuICAgICAgICB0aGlzLmNhbGNJdGVtc0FuZ2xlKCk7XHJcbiAgICAgICAgdGhpcy5zZXR1cFJvdGF0aW9uKCk7XHJcbiAgICAgICAgLy90aGlzLmNhbGNIZWlnaHQoKTtcclxuICAgIH1cclxuXHJcbiAgICBuZ09uQ2hhbmdlcygpIHtcclxuICAgICAgICB0aGlzLnNldHVwUm90YXRpb24oKTtcclxuICAgICAgICAvL3RoaXMuY2FsY0hlaWdodCgpO1xyXG4gICAgfVxyXG5cclxuLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuLy8tU2V0dXAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICAgIHByaXZhdGUgY2FsY0l0ZW1zQW5nbGUoKSB7XHJcbiAgICAgICAgdGhpcy5fYW5nbGVTdGVwID0gRlVMTF9BTkdMRSAvIHRoaXMucm90YXRlSXRlbXMubGVuZ3RoO1xyXG4gICAgICAgIGxldCBhbmdsZSA9IDA7XHJcbiAgICAgICAgdGhpcy5yb3RhdGVJdGVtcy5mb3JFYWNoKHggPT4ge1xyXG4gICAgICAgICAgICB4LmFuZ2xlID0gYW5nbGU7XHJcbiAgICAgICAgICAgIGFuZ2xlICs9IHRoaXMuX2FuZ2xlU3RlcDtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldHVwUm90YXRpb24oKSB7XHJcbiAgICAgICAgaWYgKCFOdW1iZXIuaXNOYU4odGhpcy5wZXJpb2QgYXMgYW55ICUgMSkpXHJcbiAgICAgICAgICAgIHRoaXMuX3BlcmlvZCA9IHBhcnNlSW50KHRoaXMucGVyaW9kIGFzIHN0cmluZyk7XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBlcmlvZFN0ciA9IHRoaXMucGVyaW9kIGFzIHN0cmluZztcclxuICAgICAgICAgICAgLy8gc3BsaXQgc3RyaW5nIGxpa2UgJzEwMDNtcycgdG8gJzEwMDAnIGFuZCAnbXMnXHJcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlcyA9IHBlcmlvZFN0ci5yZXBsYWNlKC9cXCcvZywgJycpLnNwbGl0KC8oWzAtOV0qXFwuP1swLTldKS8pO1xyXG4gICAgICAgICAgICB0aGlzLl9wZXJpb2QgPSB2YWx1ZXNbMl0gPT0gJ3MnID8gcGFyc2VJbnQodmFsdWVzWzFdKSAqIDEwMDAgOiBwYXJzZUludCh2YWx1ZXNbMV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5fcm90YXRpb25UaW1lclN1YnNjcmlwdGlvbilcclxuICAgICAgICAgICAgdGhpcy5fcm90YXRpb25UaW1lclN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgIHRoaXMuX3JvdGF0aW9uVGltZXJTdWJzY3JpcHRpb24gPSB0aGlzLnNldFJvdGF0aW9uVGltZXIoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNhbGNIZWlnaHQoKSB7XHJcbiAgICAgICAgY29uc3QgbWF4SCA9ICBNYXRoLm1heChudWxsLCAuLi50aGlzLnJvdGF0ZUl0ZW1zLm1hcCh4ID0+IHgudGVtcGxhdGVSZWYuZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmNsaWVudEhlaWdodCkpO1xyXG4gICAgICAgIGlmICghdGhpcy5oZWlnaHQpXHJcbiAgICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gbWF4SCArICdweCc7XHJcbiAgICB9XHJcblxyXG4vLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4vLy1FdmVudHMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4vLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG4gICAgcHJpdmF0ZSBvblJvdGF0aW9uU3RhcnQoKSB7XHJcbiAgICAgICAgdGhpcy5yb3RhdGlvblN0YXJ0LmVtaXQodGhpcy5fYWN0aXZlSW5kZXgpO1xyXG4gICAgfVxyXG5cclxuICAgIG9uUm90YXRlRW5kKCRldmVudCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9hY3RpdmVJbmRleCA9PSAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2Fyb3VzZWxJbm5lci5uYXRpdmVFbGVtZW50LnN0eWxlLnRyYW5zaXRpb24gPSAnbm9uZSc7XHJcbiAgICAgICAgICAgIHRoaXMuY2Fyb3VzZWxJbm5lci5uYXRpdmVFbGVtZW50LnN0eWxlLnRyYW5zZm9ybSA9ICdyb3RhdGVZKDBkZWcpJztcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yb3RhdGlvbkVuZC5lbWl0KHRoaXMuX2FjdGl2ZUluZGV4KTtcclxuICAgIH1cclxuXHJcbi8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbi8vLVN0eWxlLVZpc2liaWxpdHktQXZhaWxhYmlsaXR5LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbi8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAgICBnZXRDYXJvdXNlbFN0eWxlKCkge1xyXG4gICAgICAgIGNvbnN0IHdpZHRoID0gdGhpcy53aWR0aDtcclxuICAgICAgICBjb25zdCBoZWlnaHQgPSB0aGlzLmhlaWdodDtcclxuICAgICAgICBjb25zdCBkZXB0aCA9IHRoaXMuZGVwdGg7XHJcbiAgICAgICAgcmV0dXJuIHsgd2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodCwgdHJhbnNmb3JtOiAndHJhbnNsYXRlWigtJyArIGRlcHRoICsgJyknIH07XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0SXRlbVN0eWxlKGl0ZW06IFJvdGF0ZUNhcm91c2VsSXRlbURpcmVjdGl2ZSkge1xyXG4gICAgICAgIGNvbnN0IGRlcHRoID0gdGhpcy5kZXB0aDtcclxuICAgICAgICBjb25zdCBzdHlsZSA9IHsgdHJhbnNmb3JtOiAncm90YXRlWSgnICsgaXRlbS5hbmdsZSArICdkZWcpIHRyYW5zbGF0ZVooJyArIGRlcHRoICsgJyknIH07XHJcbiAgICAgICAgcmV0dXJuIHN0eWxlO1xyXG4gICAgfVxyXG5cclxuLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuLy8tTWV0aG9kcy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuLy8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuICAgIHNlbGVjdEF0KGluZGV4UGF0aDogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy5fcm90YXRpb25UaW1lclN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgIHRoaXMuY2Fyb3VzZWxJbm5lci5uYXRpdmVFbGVtZW50LnN0eWxlLnRyYW5zZm9ybSA9IGByb3RhdGVZKCR7aW5kZXhQYXRoICogdGhpcy5fYW5nbGVTdGVwfWRlZylgO1xyXG4gICAgICAgIHRoaXMuX3JvdGF0aW9uVGltZXJTdWJzY3JpcHRpb24gPSB0aGlzLnNldFJvdGF0aW9uVGltZXIoKTtcclxuICAgIH1cclxuXHJcbi8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbi8vLUhlbHAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbi8vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiAgICBzZXRSb3RhdGlvblRpbWVyKCk6IFN1YnNjcmlwdGlvbiB7XHJcbiAgICAgICAgcmV0dXJuIHRpbWVyKDAsIHRoaXMuX3BlcmlvZClcclxuICAgICAgICAgICAgLnN1YnNjcmliZSgoaTogbnVtYmVyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9hY3RpdmVJbmRleCA9IGkgJSB0aGlzLnJvdGF0ZUl0ZW1zLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIGxldCBhbmdsZTogbnVtYmVyO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2FjdGl2ZUluZGV4ID09IDEpXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYXJvdXNlbElubmVyLm5hdGl2ZUVsZW1lbnQuc3R5bGUudHJhbnNpdGlvbiA9IGB0cmFuc2Zvcm0gJHt0aGlzLl9wZXJpb2QgLyAyfW1zIGVhc2UtaW4tb3V0YDtcclxuICAgICAgICAgICAgICAgIGlmIChpID4gMCAmJiB0aGlzLl9hY3RpdmVJbmRleCA9PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgIGFuZ2xlID0gdGhpcy5yb3RhdGVJdGVtcy5sZW5ndGggKiB0aGlzLl9hbmdsZVN0ZXAgKiAodGhpcy5kaXJlY3Rpb24gPT0gJ2ZvcndhcmQnID8gLTEgOiAxKTtcclxuICAgICAgICAgICAgICAgIGVsc2VcclxuICAgICAgICAgICAgICAgICAgICBhbmdsZSA9IHRoaXMuX2FjdGl2ZUluZGV4ICogdGhpcy5fYW5nbGVTdGVwICogKHRoaXMuZGlyZWN0aW9uID09ICdmb3J3YXJkJyA/IC0xIDogMSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNhcm91c2VsSW5uZXIubmF0aXZlRWxlbWVudC5zdHlsZS50cmFuc2Zvcm0gPSBgcm90YXRlWSgke2FuZ2xlfWRlZylgO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5vblJvdGF0aW9uU3RhcnQoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuIl19