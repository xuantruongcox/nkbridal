/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ElementRef, Component, Renderer2, Input, Output, EventEmitter, ViewChild, ContentChildren, QueryList, Inject, HostListener } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { DragScrollItemDirective } from './ngx-drag-scroll-item';
export class DragScrollComponent {
    /**
     * @param {?} _elementRef
     * @param {?} _renderer
     * @param {?} _document
     */
    constructor(_elementRef, _renderer, _document) {
        this._elementRef = _elementRef;
        this._renderer = _renderer;
        this._document = _document;
        this._index = 0;
        this._scrollbarHidden = false;
        this._disabled = false;
        this._xDisabled = false;
        this._xWheelEnabled = false;
        this._yDisabled = false;
        this._dragDisabled = false;
        this._snapDisabled = false;
        this._snapOffset = 0;
        this._snapDuration = 500;
        /**
         * Is the user currently pressing the element
         */
        this.isPressed = false;
        /**
         * Is the user currently scrolling the element
         */
        this.isScrolling = false;
        this.scrollTimer = -1;
        this.scrollToTimer = -1;
        /**
         * The x coordinates on the element
         */
        this.downX = 0;
        /**
         * The y coordinates on the element
         */
        this.downY = 0;
        this.displayType = 'block';
        this.elWidth = null;
        this.elHeight = null;
        this.scrollbarWidth = null;
        this.isAnimating = false;
        this.prevChildrenLength = 0;
        this.indexBound = 0;
        this.dsInitialized = new EventEmitter();
        this.indexChanged = new EventEmitter();
        this.reachesLeftBound = new EventEmitter();
        this.reachesRightBound = new EventEmitter();
        this.snapAnimationFinished = new EventEmitter();
        this.scrollbarWidth = `${this.getScrollbarWidth()}px`;
    }
    /**
     * @return {?}
     */
    get currIndex() { return this._index; }
    /**
     * @param {?} value
     * @return {?}
     */
    set currIndex(value) {
        if (value !== this._index) {
            this._index = value;
            this.indexChanged.emit(value);
        }
    }
    /**
     * Whether the scrollbar is hidden
     * @return {?}
     */
    get scrollbarHidden() { return this._scrollbarHidden; }
    /**
     * @param {?} value
     * @return {?}
     */
    set scrollbarHidden(value) { this._scrollbarHidden = value; }
    /**
     * Whether horizontally and vertically draging and scrolling is be disabled
     * @return {?}
     */
    get disabled() { return this._disabled; }
    /**
     * @param {?} value
     * @return {?}
     */
    set disabled(value) { this._disabled = value; }
    /**
     * Whether horizontally dragging and scrolling is be disabled
     * @return {?}
     */
    get xDisabled() { return this._xDisabled; }
    /**
     * @param {?} value
     * @return {?}
     */
    set xDisabled(value) { this._xDisabled = value; }
    /**
     * Whether vertically dragging and scrolling events is disabled
     * @return {?}
     */
    get yDisabled() { return this._yDisabled; }
    /**
     * @param {?} value
     * @return {?}
     */
    set yDisabled(value) { this._yDisabled = value; }
    /**
     * Whether scrolling horizontally with mouse wheel is enabled
     * @return {?}
     */
    get xWheelEnabled() { return this._xWheelEnabled; }
    /**
     * @param {?} value
     * @return {?}
     */
    set xWheelEnabled(value) { this._xWheelEnabled = value; }
    /**
     * @return {?}
     */
    get dragDisabled() { return this._dragDisabled; }
    /**
     * @param {?} value
     * @return {?}
     */
    set dragDisabled(value) { this._dragDisabled = value; }
    /**
     * @return {?}
     */
    get snapDisabled() { return this._snapDisabled; }
    /**
     * @param {?} value
     * @return {?}
     */
    set snapDisabled(value) { this._snapDisabled = value; }
    /**
     * @return {?}
     */
    get snapOffset() { return this._snapOffset; }
    /**
     * @param {?} value
     * @return {?}
     */
    set snapOffset(value) { this._snapOffset = value; }
    /**
     * @return {?}
     */
    get snapDuration() { return this._snapDuration; }
    /**
     * @param {?} value
     * @return {?}
     */
    set snapDuration(value) { this._snapDuration = value; }
    /**
     * @return {?}
     */
    ngOnChanges() {
        this.setScrollBar();
        if (this.xDisabled || this.disabled) {
            this.disableScroll('x');
        }
        else {
            this.enableScroll('x');
        }
        if (this.yDisabled || this.disabled) {
            this.disableScroll('y');
        }
        else {
            this.enableScroll('y');
        }
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        // auto assign computed css
        this._renderer.setAttribute(this._contentRef.nativeElement, 'drag-scroll', 'true');
        this.displayType = typeof window !== 'undefined' ? window.getComputedStyle(this._elementRef.nativeElement).display : 'block';
        this._renderer.setStyle(this._contentRef.nativeElement, 'display', this.displayType);
        this._renderer.setStyle(this._contentRef.nativeElement, 'whiteSpace', 'noWrap');
        // store ele width height for later user
        this.markElDimension();
        this._renderer.setStyle(this._contentRef.nativeElement, 'width', this.elWidth);
        this._renderer.setStyle(this._contentRef.nativeElement, 'height', this.elHeight);
        if (this.wrapper) {
            this.checkScrollbar();
        }
        this._onMouseDownListener = this._renderer.listen(this._contentRef.nativeElement, 'mousedown', this.onMouseDownHandler.bind(this));
        this._onTouchStartListener = this._renderer.listen(this._contentRef.nativeElement, 'touchstart', this.onMouseDownHandler.bind(this));
        this._onScrollListener = this._renderer.listen(this._contentRef.nativeElement, 'scroll', this.onScrollHandler.bind(this));
        this._onTouchEndListener = this._renderer.listen(this._contentRef.nativeElement, 'touchend', this.onMouseUpHandler.bind(this));
        // prevent Firefox from dragging images
        this._onDragStartListener = this._renderer.listen('document', 'dragstart', (/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            e.preventDefault();
        }));
        this.checkNavStatus();
        this.dsInitialized.emit();
        this.adjustMarginToLastChild();
    }
    /**
     * @return {?}
     */
    ngAfterViewChecked() {
        // avoid extra checks
        if (this._children['_results'].length !== this.prevChildrenLength) {
            this.markElDimension();
            this.checkScrollbar();
            this.prevChildrenLength = this._children['_results'].length;
            this.checkNavStatus();
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this._renderer.setAttribute(this._contentRef.nativeElement, 'drag-scroll', 'false');
        if (this._onMouseDownListener) {
            this._onMouseDownListener = this._onMouseDownListener();
        }
        if (this._onTouchStartListener) {
            this._onTouchStartListener = this._onTouchStartListener();
        }
        if (this._onScrollListener) {
            this._onScrollListener = this._onScrollListener();
        }
        if (this._onTouchEndListener) {
            this._onTouchEndListener = this._onTouchEndListener();
        }
        if (this._onDragStartListener) {
            this._onDragStartListener = this._onDragStartListener();
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onMouseMoveHandler(event) {
        this.onMouseMove(event);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onMouseMove(event) {
        if (this.isPressed && !this.disabled) {
            /** @type {?} */
            const isTouchEvent = event.type === 'touchmove';
            // Workaround for prevent scroll stuck if browser lost focus
            if (!isTouchEvent) {
                /** @type {?} */
                const mouseEvent = (/** @type {?} */ (event));
                // MouseEvent.buttons not support by Safari
                // tslint:disable-next-line:deprecation
                if (!mouseEvent.buttons && !mouseEvent.which) {
                    return this.onMouseUpHandler(mouseEvent);
                }
            }
            // // Drag X
            if (!this.xDisabled && !this.dragDisabled) {
                /** @type {?} */
                const clientX = isTouchEvent ? ((/** @type {?} */ (event))).touches[0].clientX : ((/** @type {?} */ (event))).clientX;
                this._contentRef.nativeElement.scrollLeft =
                    this._contentRef.nativeElement.scrollLeft - clientX + this.downX;
                this.downX = clientX;
            }
            // Drag Y
            if (!this.yDisabled && !this.dragDisabled) {
                /** @type {?} */
                const clientY = isTouchEvent ? ((/** @type {?} */ (event))).touches[0].clientY : ((/** @type {?} */ (event))).clientY;
                this._contentRef.nativeElement.scrollTop =
                    this._contentRef.nativeElement.scrollTop - clientY + this.downY;
                this.downY = clientY;
            }
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onMouseDownHandler(event) {
        /** @type {?} */
        const dragScrollItem = this.locateDragScrollItem((/** @type {?} */ (event.target)));
        if (dragScrollItem && dragScrollItem.dragDisabled) {
            return;
        }
        /** @type {?} */
        const isTouchEvent = event.type === 'touchstart';
        this._startGlobalListening(isTouchEvent);
        this.isPressed = true;
        if (isTouchEvent) {
            /** @type {?} */
            const touchEvent = (/** @type {?} */ (event));
            this.downX = touchEvent.touches[0].clientX;
            this.downY = touchEvent.touches[0].clientY;
        }
        else {
            /** @type {?} */
            const mouseEvent = (/** @type {?} */ (event));
            this.downX = mouseEvent.clientX;
            this.downY = mouseEvent.clientY;
        }
        clearTimeout((/** @type {?} */ (this.scrollToTimer)));
    }
    /**
     * @return {?}
     */
    onScrollHandler() {
        this.checkNavStatus();
        if (!this.isPressed && !this.isAnimating && !this.snapDisabled) {
            this.isScrolling = true;
            clearTimeout((/** @type {?} */ (this.scrollTimer)));
            this.scrollTimer = setTimeout((/**
             * @return {?}
             */
            () => {
                this.isScrolling = false;
                this.locateCurrentIndex(true);
            }), 500);
        }
        else {
            this.locateCurrentIndex();
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onMouseUpHandler(event) {
        if (this.isPressed) {
            this.isPressed = false;
            if (!this.snapDisabled) {
                this.locateCurrentIndex(true);
            }
            else {
                this.locateCurrentIndex();
            }
            this._stopGlobalListening();
        }
    }
    /*
       * Nav button
       */
    /**
     * @return {?}
     */
    moveLeft() {
        if ((this.currIndex !== 0 || this.snapDisabled)) {
            this.currIndex--;
            clearTimeout((/** @type {?} */ (this.scrollToTimer)));
            this.scrollTo(this._contentRef.nativeElement, this.toChildrenLocation(), this.snapDuration);
        }
    }
    /**
     * @return {?}
     */
    moveRight() {
        /** @type {?} */
        const container = this.wrapper || this.parentNode;
        /** @type {?} */
        const containerWidth = container ? container.clientWidth : 0;
        if (!this.isScrollReachesRightEnd() && this.currIndex < this.maximumIndex(containerWidth, this._children)) {
            this.currIndex++;
            clearTimeout((/** @type {?} */ (this.scrollToTimer)));
            this.scrollTo(this._contentRef.nativeElement, this.toChildrenLocation(), this.snapDuration);
        }
    }
    /**
     * @param {?} index
     * @return {?}
     */
    moveTo(index) {
        /** @type {?} */
        const container = this.wrapper || this.parentNode;
        /** @type {?} */
        const containerWidth = container ? container.clientWidth : 0;
        if (index >= 0 &&
            index !== this.currIndex &&
            this.currIndex <= this.maximumIndex(containerWidth, this._children)) {
            this.currIndex = Math.min(index, this.maximumIndex(containerWidth, this._children));
            clearTimeout((/** @type {?} */ (this.scrollToTimer)));
            this.scrollTo(this._contentRef.nativeElement, this.toChildrenLocation(), this.snapDuration);
        }
    }
    /**
     * @return {?}
     */
    checkNavStatus() {
        setTimeout((/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const onlyOneItem = Boolean(this._children['_results'].length <= 1);
            /** @type {?} */
            const containerIsLargerThanContent = Boolean(this._contentRef.nativeElement.scrollWidth <=
                this._contentRef.nativeElement.clientWidth);
            if (onlyOneItem || containerIsLargerThanContent) {
                // only one element
                this.reachesLeftBound.emit(true);
                this.reachesRightBound.emit(true);
            }
            else if (this.isScrollReachesRightEnd()) {
                // reached right end
                this.reachesLeftBound.emit(false);
                this.reachesRightBound.emit(true);
            }
            else if (this._contentRef.nativeElement.scrollLeft === 0 &&
                this._contentRef.nativeElement.scrollWidth > this._contentRef.nativeElement.clientWidth) {
                // reached left end
                this.reachesLeftBound.emit(true);
                this.reachesRightBound.emit(false);
            }
            else {
                // in the middle
                this.reachesLeftBound.emit(false);
                this.reachesRightBound.emit(false);
            }
        }), 0);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onWheel(event) {
        if (this._xWheelEnabled) {
            event.preventDefault();
            if (this._snapDisabled) {
                this._contentRef.nativeElement.scrollBy(event.deltaY, 0);
            }
            else {
                if (event.deltaY < 0) {
                    this.moveLeft();
                }
                else if (event.deltaY > 0) {
                    this.moveRight();
                }
            }
        }
    }
    /**
     * @return {?}
     */
    onWindowResize() {
        this.refreshWrapperDimensions();
    }
    /**
     * @private
     * @param {?} isTouchEvent
     * @return {?}
     */
    _startGlobalListening(isTouchEvent) {
        if (!this._onMouseMoveListener) {
            /** @type {?} */
            const eventName = isTouchEvent ? 'touchmove' : 'mousemove';
            this._onMouseMoveListener = this._renderer.listen('document', eventName, this.onMouseMoveHandler.bind(this));
        }
        if (!this._onMouseUpListener) {
            /** @type {?} */
            const eventName = isTouchEvent ? 'touchend' : 'mouseup';
            this._onMouseUpListener = this._renderer.listen('document', eventName, this.onMouseUpHandler.bind(this));
        }
    }
    /**
     * @private
     * @return {?}
     */
    _stopGlobalListening() {
        if (this._onMouseMoveListener) {
            this._onMouseMoveListener = this._onMouseMoveListener();
        }
        if (this._onMouseUpListener) {
            this._onMouseUpListener = this._onMouseUpListener();
        }
    }
    /**
     * @private
     * @param {?} axis
     * @return {?}
     */
    disableScroll(axis) {
        this._renderer.setStyle(this._contentRef.nativeElement, `overflow-${axis}`, 'hidden');
    }
    /**
     * @private
     * @param {?} axis
     * @return {?}
     */
    enableScroll(axis) {
        this._renderer.setStyle(this._contentRef.nativeElement, `overflow-${axis}`, 'auto');
    }
    /**
     * @private
     * @return {?}
     */
    hideScrollbar() {
        if (this._contentRef.nativeElement.style.display !== 'none' && !this.wrapper) {
            this.parentNode = this._contentRef.nativeElement.parentNode;
            // create container element
            this.wrapper = this._renderer.createElement('div');
            this._renderer.setAttribute(this.wrapper, 'class', 'drag-scroll-wrapper');
            this._renderer.addClass(this.wrapper, 'drag-scroll-container');
            this.refreshWrapperDimensions();
            this._renderer.setStyle(this.wrapper, 'overflow', 'hidden');
            this._renderer.setStyle(this._contentRef.nativeElement, 'width', `calc(100% + ${this.scrollbarWidth})`);
            this._renderer.setStyle(this._contentRef.nativeElement, 'height', `calc(100% + ${this.scrollbarWidth})`);
            // Append container element to component element.
            this._renderer.appendChild(this._elementRef.nativeElement, this.wrapper);
            // Append content element to container element.
            this._renderer.appendChild(this.wrapper, this._contentRef.nativeElement);
            this.adjustMarginToLastChild();
        }
    }
    /**
     * @private
     * @return {?}
     */
    showScrollbar() {
        if (this.wrapper) {
            this._renderer.setStyle(this._contentRef.nativeElement, 'width', '100%');
            this._renderer.setStyle(this._contentRef.nativeElement, 'height', this.wrapper.style.height);
            if (this.parentNode !== null) {
                this.parentNode.removeChild(this.wrapper);
                this.parentNode.appendChild(this._contentRef.nativeElement);
            }
            this.wrapper = null;
            this.adjustMarginToLastChild();
        }
    }
    /**
     * @private
     * @return {?}
     */
    checkScrollbar() {
        if (this._contentRef.nativeElement.scrollWidth <= this._contentRef.nativeElement.clientWidth) {
            this._renderer.setStyle(this._contentRef.nativeElement, 'height', '100%');
        }
        else {
            this._renderer.setStyle(this._contentRef.nativeElement, 'height', `calc(100% + ${this.scrollbarWidth})`);
        }
        if (this._contentRef.nativeElement.scrollHeight <= this._contentRef.nativeElement.clientHeight) {
            this._renderer.setStyle(this._contentRef.nativeElement, 'width', '100%');
        }
        else {
            this._renderer.setStyle(this._contentRef.nativeElement, 'width', `calc(100% + ${this.scrollbarWidth})`);
        }
    }
    /**
     * @private
     * @return {?}
     */
    setScrollBar() {
        if (this.scrollbarHidden) {
            this.hideScrollbar();
        }
        else {
            this.showScrollbar();
        }
    }
    /**
     * @private
     * @return {?}
     */
    getScrollbarWidth() {
        /**
         * Browser Scrollbar Widths (2016)
         * OSX (Chrome, Safari, Firefox) - 15px
         * Windows XP (IE7, Chrome, Firefox) - 17px
         * Windows 7 (IE10, IE11, Chrome, Firefox) - 17px
         * Windows 8.1 (IE11, Chrome, Firefox) - 17px
         * Windows 10 (IE11, Chrome, Firefox) - 17px
         * Windows 10 (Edge 12/13) - 12px
         * @type {?}
         */
        const outer = this._renderer.createElement('div');
        this._renderer.setStyle(outer, 'visibility', 'hidden');
        this._renderer.setStyle(outer, 'width', '100px');
        this._renderer.setStyle(outer, 'msOverflowStyle', 'scrollbar'); // needed for WinJS apps
        // document.body.appendChild(outer);
        this._renderer.appendChild(this._document.body, outer);
        // this._renderer.appendChild(this._renderer.selectRootElement('body'), outer);
        /** @type {?} */
        const widthNoScroll = outer.offsetWidth;
        // force scrollbars
        this._renderer.setStyle(outer, 'overflow', 'scroll');
        // add innerdiv
        /** @type {?} */
        const inner = this._renderer.createElement('div');
        this._renderer.setStyle(inner, 'width', '100%');
        this._renderer.appendChild(outer, inner);
        /** @type {?} */
        const widthWithScroll = inner.offsetWidth;
        // remove divs
        this._renderer.removeChild(this._document.body, outer);
        /**
         * Scrollbar width will be 0 on Mac OS with the
         * default "Only show scrollbars when scrolling" setting (Yosemite and up).
         * setting default width to 20;
         */
        return widthNoScroll - widthWithScroll || 20;
    }
    /**
     * @private
     * @return {?}
     */
    refreshWrapperDimensions() {
        if (this.wrapper) {
            this._renderer.setStyle(this.wrapper, 'width', '100%');
            this._renderer.setStyle(this.wrapper, 'height', this._elementRef.nativeElement.style.height
                || this._elementRef.nativeElement.offsetHeight + 'px');
        }
    }
    /*
      * The below solution is heavily inspired from
      * https://gist.github.com/andjosh/6764939
      */
    /**
     * @private
     * @param {?} element
     * @param {?} to
     * @param {?} duration
     * @return {?}
     */
    scrollTo(element, to, duration) {
        /** @type {?} */
        const self = this;
        self.isAnimating = true;
        /** @type {?} */
        const start = element.scrollLeft;
        /** @type {?} */
        const change = to - start - this.snapOffset;
        /** @type {?} */
        const increment = 20;
        /** @type {?} */
        let currentTime = 0;
        // t = current time
        // b = start value
        // c = change in value
        // d = duration
        /** @type {?} */
        const easeInOutQuad = (/**
         * @param {?} t
         * @param {?} b
         * @param {?} c
         * @param {?} d
         * @return {?}
         */
        function (t, b, c, d) {
            t /= d / 2;
            if (t < 1) {
                return c / 2 * t * t + b;
            }
            t--;
            return -c / 2 * (t * (t - 2) - 1) + b;
        });
        /** @type {?} */
        const animateScroll = (/**
         * @return {?}
         */
        function () {
            currentTime += increment;
            element.scrollLeft = easeInOutQuad(currentTime, start, change, duration);
            if (currentTime < duration) {
                self.scrollToTimer = setTimeout(animateScroll, increment);
            }
            else {
                // run one more frame to make sure the animation is fully finished
                setTimeout((/**
                 * @return {?}
                 */
                () => {
                    self.isAnimating = false;
                    self.snapAnimationFinished.emit(self.currIndex);
                }), increment);
            }
        });
        animateScroll();
    }
    /**
     * @private
     * @param {?=} snap
     * @return {?}
     */
    locateCurrentIndex(snap) {
        this.currentChildWidth((/**
         * @param {?} currentChildWidth
         * @param {?} nextChildrenWidth
         * @param {?} childrenWidth
         * @param {?} idx
         * @param {?} stop
         * @return {?}
         */
        (currentChildWidth, nextChildrenWidth, childrenWidth, idx, stop) => {
            if ((this._contentRef.nativeElement.scrollLeft >= childrenWidth &&
                this._contentRef.nativeElement.scrollLeft <= nextChildrenWidth)) {
                if (nextChildrenWidth - this._contentRef.nativeElement.scrollLeft > currentChildWidth / 2 && !this.isScrollReachesRightEnd()) {
                    // roll back scrolling
                    if (!this.isAnimating) {
                        this.currIndex = idx;
                    }
                    if (snap) {
                        this.scrollTo(this._contentRef.nativeElement, childrenWidth, this.snapDuration);
                    }
                }
                else {
                    // forward scrolling
                    if (!this.isAnimating) {
                        this.currIndex = idx + 1;
                    }
                    if (snap) {
                        this.scrollTo(this._contentRef.nativeElement, childrenWidth + currentChildWidth, this.snapDuration);
                    }
                }
                stop();
            }
            else if ((idx + 1) === (this._children['_results'].length - 1)) {
                // reaches last index
                if (!this.isAnimating) {
                    this.currIndex = idx + 1;
                }
                stop();
            }
        }));
    }
    /**
     * @private
     * @param {?} cb
     * @return {?}
     */
    currentChildWidth(cb) {
        /** @type {?} */
        let childrenWidth = 0;
        /** @type {?} */
        let shouldBreak = false;
        /** @type {?} */
        const breakFunc = (/**
         * @return {?}
         */
        function () {
            shouldBreak = true;
        });
        for (let i = 0; i < this._children['_results'].length; i++) {
            if (i === this._children['_results'].length - 1) {
                break;
            }
            if (shouldBreak) {
                break;
            }
            /** @type {?} */
            const nextChildrenWidth = childrenWidth + this._children['_results'][i + 1]._elementRef.nativeElement.clientWidth;
            /** @type {?} */
            const currentClildWidth = this._children['_results'][i]._elementRef.nativeElement.clientWidth;
            cb(currentClildWidth, nextChildrenWidth, childrenWidth, i, breakFunc);
            childrenWidth += currentClildWidth;
        }
    }
    /**
     * @private
     * @return {?}
     */
    toChildrenLocation() {
        /** @type {?} */
        let to = this.scrollbarHidden ? this.getScrollbarWidth() : 0;
        for (let i = 0; i < this.currIndex; i++) {
            to += this._children['_results'][i]._elementRef.nativeElement.clientWidth;
        }
        return to;
    }
    /**
     * @private
     * @param {?} element
     * @return {?}
     */
    locateDragScrollItem(element) {
        /** @type {?} */
        let item = null;
        for (let i = 0; i < this._children['_results'].length; i++) {
            if (element === this._children['_results'][i]._elementRef.nativeElement) {
                item = this._children['_results'][i];
            }
        }
        return item;
    }
    /**
     * @private
     * @return {?}
     */
    markElDimension() {
        if (this.wrapper) {
            this.elWidth = this.wrapper.style.width;
            this.elHeight = this.wrapper.style.height;
        }
        else {
            this.elWidth = this._elementRef.nativeElement.style.width || (this._elementRef.nativeElement.offsetWidth + 'px');
            this.elHeight = this._elementRef.nativeElement.style.height || (this._elementRef.nativeElement.offsetHeight + 'px');
        }
        /** @type {?} */
        const container = this.wrapper || this.parentNode;
        /** @type {?} */
        const containerWidth = container ? container.clientWidth : 0;
        this.indexBound = this.maximumIndex(containerWidth, this._children);
    }
    /**
     * @private
     * @param {?} containerWidth
     * @param {?} childrenElements
     * @return {?}
     */
    maximumIndex(containerWidth, childrenElements) {
        /** @type {?} */
        let count = 0;
        /** @type {?} */
        let childrenWidth = 0;
        for (let i = 0; i <= childrenElements['_results'].length; i++) {
            // last N element
            /** @type {?} */
            const dragScrollItemDirective = childrenElements['_results'][childrenElements['_results'].length - 1 - i];
            if (!dragScrollItemDirective) {
                break;
            }
            else {
                childrenWidth += dragScrollItemDirective._elementRef.nativeElement.clientWidth;
                if (childrenWidth < containerWidth) {
                    count++;
                }
                else {
                    break;
                }
            }
        }
        return childrenElements.length - count;
    }
    /**
     * @private
     * @return {?}
     */
    isScrollReachesRightEnd() {
        /** @type {?} */
        const scrollLeftPos = this._contentRef.nativeElement.scrollLeft + this._contentRef.nativeElement.offsetWidth;
        return scrollLeftPos >= this._contentRef.nativeElement.scrollWidth;
    }
    /**
     * adds a margin right style to the last child element which will resolve the issue
     * of last item gets cutoff.
     * @private
     * @return {?}
     */
    adjustMarginToLastChild() {
        if (this._children && this.hideScrollbar) {
            /** @type {?} */
            const lastItem = this._children['_results'][this._children['_results'].length - 1]._elementRef.nativeElement;
            if (this.wrapper && this._children['_results'].length > 1) {
                this._renderer.setStyle(lastItem, 'margin-right', this.scrollbarWidth);
            }
            else {
                this._renderer.setStyle(lastItem, 'margin-right', 0);
            }
        }
    }
}
DragScrollComponent.decorators = [
    { type: Component, args: [{
                selector: 'drag-scroll',
                template: `
    <div class="drag-scroll-content" #contentRef>
      <ng-content></ng-content>
    </div>
  `,
                styles: [`
    :host {
      overflow: hidden;
      display: block;
    }
    .drag-scroll-content {
      height: 100%;
      overflow: auto;
      white-space: nowrap;
    }
    `]
            }] }
];
/** @nocollapse */
DragScrollComponent.ctorParameters = () => [
    { type: ElementRef, decorators: [{ type: Inject, args: [ElementRef,] }] },
    { type: Renderer2, decorators: [{ type: Inject, args: [Renderer2,] }] },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];
DragScrollComponent.propDecorators = {
    _contentRef: [{ type: ViewChild, args: ['contentRef',] }],
    _children: [{ type: ContentChildren, args: [DragScrollItemDirective,] }],
    dsInitialized: [{ type: Output }],
    indexChanged: [{ type: Output }],
    reachesLeftBound: [{ type: Output }],
    reachesRightBound: [{ type: Output }],
    snapAnimationFinished: [{ type: Output }],
    scrollbarHidden: [{ type: Input, args: ['scrollbar-hidden',] }],
    disabled: [{ type: Input, args: ['drag-scroll-disabled',] }],
    xDisabled: [{ type: Input, args: ['drag-scroll-x-disabled',] }],
    yDisabled: [{ type: Input, args: ['drag-scroll-y-disabled',] }],
    xWheelEnabled: [{ type: Input, args: ['scroll-x-wheel-enabled',] }],
    dragDisabled: [{ type: Input, args: ['drag-disabled',] }],
    snapDisabled: [{ type: Input, args: ['snap-disabled',] }],
    snapOffset: [{ type: Input, args: ['snap-offset',] }],
    snapDuration: [{ type: Input, args: ['snap-duration',] }],
    onWheel: [{ type: HostListener, args: ['wheel', ['$event'],] }],
    onWindowResize: [{ type: HostListener, args: ['window:resize',] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    DragScrollComponent.prototype._index;
    /**
     * @type {?}
     * @private
     */
    DragScrollComponent.prototype._scrollbarHidden;
    /**
     * @type {?}
     * @private
     */
    DragScrollComponent.prototype._disabled;
    /**
     * @type {?}
     * @private
     */
    DragScrollComponent.prototype._xDisabled;
    /**
     * @type {?}
     * @private
     */
    DragScrollComponent.prototype._xWheelEnabled;
    /**
     * @type {?}
     * @private
     */
    DragScrollComponent.prototype._yDisabled;
    /**
     * @type {?}
     * @private
     */
    DragScrollComponent.prototype._dragDisabled;
    /**
     * @type {?}
     * @private
     */
    DragScrollComponent.prototype._snapDisabled;
    /**
     * @type {?}
     * @private
     */
    DragScrollComponent.prototype._snapOffset;
    /**
     * @type {?}
     * @private
     */
    DragScrollComponent.prototype._snapDuration;
    /**
     * @type {?}
     * @private
     */
    DragScrollComponent.prototype._onMouseMoveListener;
    /**
     * @type {?}
     * @private
     */
    DragScrollComponent.prototype._onMouseUpListener;
    /**
     * @type {?}
     * @private
     */
    DragScrollComponent.prototype._onMouseDownListener;
    /**
     * @type {?}
     * @private
     */
    DragScrollComponent.prototype._onTouchStartListener;
    /**
     * @type {?}
     * @private
     */
    DragScrollComponent.prototype._onScrollListener;
    /**
     * @type {?}
     * @private
     */
    DragScrollComponent.prototype._onTouchEndListener;
    /**
     * @type {?}
     * @private
     */
    DragScrollComponent.prototype._onDragStartListener;
    /**
     * Is the user currently pressing the element
     * @type {?}
     */
    DragScrollComponent.prototype.isPressed;
    /**
     * Is the user currently scrolling the element
     * @type {?}
     */
    DragScrollComponent.prototype.isScrolling;
    /** @type {?} */
    DragScrollComponent.prototype.scrollTimer;
    /** @type {?} */
    DragScrollComponent.prototype.scrollToTimer;
    /**
     * The x coordinates on the element
     * @type {?}
     */
    DragScrollComponent.prototype.downX;
    /**
     * The y coordinates on the element
     * @type {?}
     */
    DragScrollComponent.prototype.downY;
    /** @type {?} */
    DragScrollComponent.prototype.displayType;
    /** @type {?} */
    DragScrollComponent.prototype.elWidth;
    /** @type {?} */
    DragScrollComponent.prototype.elHeight;
    /**
     * The parentNode of carousel Element
     * @type {?}
     */
    DragScrollComponent.prototype.parentNode;
    /**
     * The carousel Element
     * @type {?}
     */
    DragScrollComponent.prototype._contentRef;
    /** @type {?} */
    DragScrollComponent.prototype._children;
    /** @type {?} */
    DragScrollComponent.prototype.wrapper;
    /** @type {?} */
    DragScrollComponent.prototype.scrollbarWidth;
    /** @type {?} */
    DragScrollComponent.prototype.isAnimating;
    /** @type {?} */
    DragScrollComponent.prototype.prevChildrenLength;
    /** @type {?} */
    DragScrollComponent.prototype.indexBound;
    /** @type {?} */
    DragScrollComponent.prototype.dsInitialized;
    /** @type {?} */
    DragScrollComponent.prototype.indexChanged;
    /** @type {?} */
    DragScrollComponent.prototype.reachesLeftBound;
    /** @type {?} */
    DragScrollComponent.prototype.reachesRightBound;
    /** @type {?} */
    DragScrollComponent.prototype.snapAnimationFinished;
    /**
     * @type {?}
     * @private
     */
    DragScrollComponent.prototype._elementRef;
    /**
     * @type {?}
     * @private
     */
    DragScrollComponent.prototype._renderer;
    /**
     * @type {?}
     * @private
     */
    DragScrollComponent.prototype._document;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWRyYWctc2Nyb2xsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1kcmFnLXNjcm9sbC8iLCJzb3VyY2VzIjpbImxpYi9uZ3gtZHJhZy1zY3JvbGwuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQ0wsVUFBVSxFQUNWLFNBQVMsRUFDVCxTQUFTLEVBRVQsS0FBSyxFQUNMLE1BQU0sRUFHTixZQUFZLEVBQ1osU0FBUyxFQUNULGVBQWUsRUFFZixTQUFTLEVBQ1QsTUFBTSxFQUNOLFlBQVksRUFDYixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFM0MsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFxQmpFLE1BQU0sT0FBTyxtQkFBbUI7Ozs7OztJQTZKOUIsWUFDOEIsV0FBdUIsRUFDeEIsU0FBb0IsRUFDckIsU0FBYztRQUZaLGdCQUFXLEdBQVgsV0FBVyxDQUFZO1FBQ3hCLGNBQVMsR0FBVCxTQUFTLENBQVc7UUFDckIsY0FBUyxHQUFULFNBQVMsQ0FBSztRQS9KbEMsV0FBTSxHQUFHLENBQUMsQ0FBQztRQUVYLHFCQUFnQixHQUFHLEtBQUssQ0FBQztRQUV6QixjQUFTLEdBQUcsS0FBSyxDQUFDO1FBRWxCLGVBQVUsR0FBRyxLQUFLLENBQUM7UUFFbkIsbUJBQWMsR0FBRyxLQUFLLENBQUM7UUFFdkIsZUFBVSxHQUFHLEtBQUssQ0FBQztRQUVuQixrQkFBYSxHQUFHLEtBQUssQ0FBQztRQUV0QixrQkFBYSxHQUFHLEtBQUssQ0FBQztRQUV0QixnQkFBVyxHQUFHLENBQUMsQ0FBQztRQUVoQixrQkFBYSxHQUFHLEdBQUcsQ0FBQzs7OztRQW1CNUIsY0FBUyxHQUFHLEtBQUssQ0FBQzs7OztRQUtsQixnQkFBVyxHQUFHLEtBQUssQ0FBQztRQUVwQixnQkFBVyxHQUEwQixDQUFDLENBQUMsQ0FBQztR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QUMsZUFBZTs7Ozs7OztJQXhaN0IscUNBQW1COzs7OztJQUVuQiwrQ0FBaUM7Ozs7O0lBRWpDLHdDQUEwQjs7Ozs7SUFFMUIseUNBQTJCOzs7OztJQUUzQiw2Q0FBK0I7Ozs7O0lBRS9CLHlDQUEyQjs7Ozs7SUFFM0IsNENBQThCOzs7OztJQUU5Qiw0Q0FBOEI7Ozs7O0lBRTlCLDBDQUF3Qjs7Ozs7SUFFeEIsNENBQTRCOzs7OztJQUU1QixtREFBdUM7Ozs7O0lBRXZDLGlEQUFxQzs7Ozs7SUFFckMsbURBQXVDOzs7OztJQUV2QyxvREFBd0M7Ozs7O0lBRXhDLGdEQUFvQzs7Ozs7SUFFcEMsa0RBQXNDOzs7OztJQUV0QyxtREFBdUM7Ozs7O0lBS3ZDLHdDQUFrQjs7Ozs7SUFLbEIsMENBQW9COztJQUVwQiwwQ0FBd0M7O0lBRXhDLDRDQUEwQzs7Ozs7SUFLMUMsb0NBQVU7Ozs7O0lBS1Ysb0NBQVU7O0lBRVYsMENBQXFDOztJQUVyQyxzQ0FBOEI7O0lBRTlCLHVDQUErQjs7Ozs7SUFLL0IseUNBQXdCOzs7OztJQU14QiwwQ0FBaUQ7O0lBRWpELHdDQUF3Rjs7SUFFeEYsc0NBQStCOztJQUUvQiw2Q0FBcUM7O0lBVXJDLDBDQUFvQjs7SUFFcEIsaURBQXVCOztJQUV2Qix5Q0FBZTs7SUFFZiw0Q0FBbUQ7O0lBRW5ELDJDQUFvRDs7SUFFcEQsK0NBQXlEOztJQUV6RCxnREFBMEQ7O0lBRTFELG9EQUE2RDs7Ozs7SUFzRDNELDBDQUFtRDs7Ozs7SUFDbkQsd0NBQStDOzs7OztJQUMvQyx3Q0FBd0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBFbGVtZW50UmVmLFxuICBDb21wb25lbnQsXG4gIFJlbmRlcmVyMixcbiAgT25EZXN0cm95LFxuICBJbnB1dCxcbiAgT3V0cHV0LFxuICBBZnRlclZpZXdJbml0LFxuICBPbkNoYW5nZXMsXG4gIEV2ZW50RW1pdHRlcixcbiAgVmlld0NoaWxkLFxuICBDb250ZW50Q2hpbGRyZW4sXG4gIEFmdGVyVmlld0NoZWNrZWQsXG4gIFF1ZXJ5TGlzdCxcbiAgSW5qZWN0LFxuICBIb3N0TGlzdGVuZXJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBET0NVTUVOVCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5cbmltcG9ydCB7IERyYWdTY3JvbGxJdGVtRGlyZWN0aXZlIH0gZnJvbSAnLi9uZ3gtZHJhZy1zY3JvbGwtaXRlbSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2RyYWctc2Nyb2xsJyxcbiAgdGVtcGxhdGU6IGBcbiAgICA8ZGl2IGNsYXNzPVwiZHJhZy1zY3JvbGwtY29udGVudFwiICNjb250ZW50UmVmPlxuICAgICAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuICAgIDwvZGl2PlxuICBgLFxuICBzdHlsZXM6IFtgXG4gICAgOmhvc3Qge1xuICAgICAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgIH1cbiAgICAuZHJhZy1zY3JvbGwtY29udGVudCB7XG4gICAgICBoZWlnaHQ6IDEwMCU7XG4gICAgICBvdmVyZmxvdzogYXV0bztcbiAgICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7XG4gICAgfVxuICAgIGBdXG59KVxuZXhwb3J0IGNsYXNzIERyYWdTY3JvbGxDb21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3ksIEFmdGVyVmlld0luaXQsIE9uQ2hhbmdlcywgQWZ0ZXJWaWV3Q2hlY2tlZCB7XG4gIHByaXZhdGUgX2luZGV4ID0gMDtcblxuICBwcml2YXRlIF9zY3JvbGxiYXJIaWRkZW4gPSBmYWxzZTtcblxuICBwcml2YXRlIF9kaXNhYmxlZCA9IGZhbHNlO1xuXG4gIHByaXZhdGUgX3hEaXNhYmxlZCA9IGZhbHNlO1xuXG4gIHByaXZhdGUgX3hXaGVlbEVuYWJsZWQgPSBmYWxzZTtcblxuICBwcml2YXRlIF95RGlzYWJsZWQgPSBmYWxzZTtcblxuICBwcml2YXRlIF9kcmFnRGlzYWJsZWQgPSBmYWxzZTtcblxuICBwcml2YXRlIF9zbmFwRGlzYWJsZWQgPSBmYWxzZTtcblxuICBwcml2YXRlIF9zbmFwT2Zmc2V0ID0gMDtcblxuICBwcml2YXRlIF9zbmFwRHVyYXRpb24gPSA1MDA7XG5cbiAgcHJpdmF0ZSBfb25Nb3VzZU1vdmVMaXN0ZW5lcjogRnVuY3Rpb247XG5cbiAgcHJpdmF0ZSBfb25Nb3VzZVVwTGlzdGVuZXI6IEZ1bmN0aW9uO1xuXG4gIHByaXZhdGUgX29uTW91c2VEb3duTGlzdGVuZXI6IEZ1bmN0aW9uO1xuXG4gIHByaXZhdGUgX29uVG91Y2hTdGFydExpc3RlbmVyOiBGdW5jdGlvbjtcblxuICBwcml2YXRlIF9vblNjcm9sbExpc3RlbmVyOiBGdW5jdGlvbjtcblxuICBwcml2YXRlIF9vblRvdWNoRW5kTGlzdGVuZXI6IEZ1bmN0aW9uO1xuXG4gIHByaXZhdGUgX29uRHJhZ1N0YXJ0TGlzdGVuZXI6IEZ1bmN0aW9uO1xuXG4gIC8qKlxuICAgKiBJcyB0aGUgdXNlciBjdXJyZW50bHkgcHJlc3NpbmcgdGhlIGVsZW1lbnRcbiAgICovXG4gIGlzUHJlc3NlZCA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBJcyB0aGUgdXNlciBjdXJyZW50bHkgc2Nyb2xsaW5nIHRoZSBlbGVtZW50XG4gICAqL1xuICBpc1Njcm9sbGluZyA9IGZhbHNlO1xuXG4gIHNjcm9sbFRpbWVyOiBudW1iZXIgfCBOb2RlSlMuVGltZXIgPSAtMTtcblxuICBzY3JvbGxUb1RpbWVyOiBudW1iZXIgfCBOb2RlSlMuVGltZXIgPSAtMTtcblxuICAvKipcbiAgICogVGhlIHggY29vcmRpbmF0ZXMgb24gdGhlIGVsZW1lbnRcbiAgICovXG4gIGRvd25YID0gMDtcblxuICAvKipcbiAgICogVGhlIHkgY29vcmRpbmF0ZXMgb24gdGhlIGVsZW1lbnRcbiAgICovXG4gIGRvd25ZID0gMDtcblxuICBkaXNwbGF5VHlwZTogc3RyaW5nIHwgbnVsbCA9ICdibG9jayc7XG5cbiAgZWxXaWR0aDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG5cbiAgZWxIZWlnaHQ6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuXG4gIC8qKlxuICAgKiBUaGUgcGFyZW50Tm9kZSBvZiBjYXJvdXNlbCBFbGVtZW50XG4gICAqL1xuICBwYXJlbnROb2RlOiBIVE1MRWxlbWVudDtcblxuICAvKipcbiAgICogVGhlIGNhcm91c2VsIEVsZW1lbnRcbiAgICovXG5cbiAgQFZpZXdDaGlsZCgnY29udGVudFJlZicpIF9jb250ZW50UmVmOiBFbGVtZW50UmVmO1xuXG4gIEBDb250ZW50Q2hpbGRyZW4oRHJhZ1Njcm9sbEl0ZW1EaXJlY3RpdmUpIF9jaGlsZHJlbjogUXVlcnlMaXN0PERyYWdTY3JvbGxJdGVtRGlyZWN0aXZlPjtcblxuICB3cmFwcGVyOiBIVE1MRGl2RWxlbWVudCB8IG51bGw7XG5cbiAgc2Nyb2xsYmFyV2lkdGg6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuXG4gIGdldCBjdXJySW5kZXgoKSB7IHJldHVybiB0aGlzLl9pbmRleDsgfVxuICBzZXQgY3VyckluZGV4KHZhbHVlKSB7XG4gICAgaWYgKHZhbHVlICE9PSB0aGlzLl9pbmRleCkge1xuICAgICAgdGhpcy5faW5kZXggPSB2YWx1ZTtcbiAgICAgIHRoaXMuaW5kZXhDaGFuZ2VkLmVtaXQodmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIGlzQW5pbWF0aW5nID0gZmFsc2U7XG5cbiAgcHJldkNoaWxkcmVuTGVuZ3RoID0gMDtcblxuICBpbmRleEJvdW5kID0gMDtcblxuICBAT3V0cHV0KCkgZHNJbml0aWFsaXplZCA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcblxuICBAT3V0cHV0KCkgaW5kZXhDaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcjxudW1iZXI+KCk7XG5cbiAgQE91dHB1dCgpIHJlYWNoZXNMZWZ0Qm91bmQgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XG5cbiAgQE91dHB1dCgpIHJlYWNoZXNSaWdodEJvdW5kID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xuXG4gIEBPdXRwdXQoKSBzbmFwQW5pbWF0aW9uRmluaXNoZWQgPSBuZXcgRXZlbnRFbWl0dGVyPG51bWJlcj4oKTtcblxuICAvKipcbiAgICogV2hldGhlciB0aGUgc2Nyb2xsYmFyIGlzIGhpZGRlblxuICAgKi9cbiAgQElucHV0KCdzY3JvbGxiYXItaGlkZGVuJylcbiAgZ2V0IHNjcm9sbGJhckhpZGRlbigpIHsgcmV0dXJuIHRoaXMuX3Njcm9sbGJhckhpZGRlbjsgfVxuICBzZXQgc2Nyb2xsYmFySGlkZGVuKHZhbHVlOiBib29sZWFuKSB7IHRoaXMuX3Njcm9sbGJhckhpZGRlbiA9IHZhbHVlOyB9XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgaG9yaXpvbnRhbGx5IGFuZCB2ZXJ0aWNhbGx5IGRyYWdpbmcgYW5kIHNjcm9sbGluZyBpcyBiZSBkaXNhYmxlZFxuICAgKi9cbiAgQElucHV0KCdkcmFnLXNjcm9sbC1kaXNhYmxlZCcpXG4gIGdldCBkaXNhYmxlZCgpIHsgcmV0dXJuIHRoaXMuX2Rpc2FibGVkOyB9XG4gIHNldCBkaXNhYmxlZCh2YWx1ZTogYm9vbGVhbikgeyB0aGlzLl9kaXNhYmxlZCA9IHZhbHVlOyB9XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgaG9yaXpvbnRhbGx5IGRyYWdnaW5nIGFuZCBzY3JvbGxpbmcgaXMgYmUgZGlzYWJsZWRcbiAgICovXG4gIEBJbnB1dCgnZHJhZy1zY3JvbGwteC1kaXNhYmxlZCcpXG4gIGdldCB4RGlzYWJsZWQoKSB7IHJldHVybiB0aGlzLl94RGlzYWJsZWQ7IH1cbiAgc2V0IHhEaXNhYmxlZCh2YWx1ZTogYm9vbGVhbikgeyB0aGlzLl94RGlzYWJsZWQgPSB2YWx1ZTsgfVxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHZlcnRpY2FsbHkgZHJhZ2dpbmcgYW5kIHNjcm9sbGluZyBldmVudHMgaXMgZGlzYWJsZWRcbiAgICovXG4gIEBJbnB1dCgnZHJhZy1zY3JvbGwteS1kaXNhYmxlZCcpXG4gIGdldCB5RGlzYWJsZWQoKSB7IHJldHVybiB0aGlzLl95RGlzYWJsZWQ7IH1cbiAgc2V0IHlEaXNhYmxlZCh2YWx1ZTogYm9vbGVhbikgeyB0aGlzLl95RGlzYWJsZWQgPSB2YWx1ZTsgfVxuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHNjcm9sbGluZyBob3Jpem9udGFsbHkgd2l0aCBtb3VzZSB3aGVlbCBpcyBlbmFibGVkXG4gICAqL1xuICBASW5wdXQoJ3Njcm9sbC14LXdoZWVsLWVuYWJsZWQnKVxuICBnZXQgeFdoZWVsRW5hYmxlZCgpIHsgcmV0dXJuIHRoaXMuX3hXaGVlbEVuYWJsZWQ7IH1cbiAgc2V0IHhXaGVlbEVuYWJsZWQodmFsdWU6IGJvb2xlYW4pIHsgdGhpcy5feFdoZWVsRW5hYmxlZCA9IHZhbHVlOyB9XG5cbiAgQElucHV0KCdkcmFnLWRpc2FibGVkJylcbiAgZ2V0IGRyYWdEaXNhYmxlZCgpIHsgcmV0dXJuIHRoaXMuX2RyYWdEaXNhYmxlZDsgfVxuICBzZXQgZHJhZ0Rpc2FibGVkKHZhbHVlOiBib29sZWFuKSB7IHRoaXMuX2RyYWdEaXNhYmxlZCA9IHZhbHVlOyB9XG5cbiAgQElucHV0KCdzbmFwLWRpc2FibGVkJylcbiAgZ2V0IHNuYXBEaXNhYmxlZCgpIHsgcmV0dXJuIHRoaXMuX3NuYXBEaXNhYmxlZDsgfVxuICBzZXQgc25hcERpc2FibGVkKHZhbHVlOiBib29sZWFuKSB7IHRoaXMuX3NuYXBEaXNhYmxlZCA9IHZhbHVlOyB9XG5cbiAgQElucHV0KCdzbmFwLW9mZnNldCcpXG4gIGdldCBzbmFwT2Zmc2V0KCkgeyByZXR1cm4gdGhpcy5fc25hcE9mZnNldDsgfVxuICBzZXQgc25hcE9mZnNldCh2YWx1ZTogbnVtYmVyKSB7IHRoaXMuX3NuYXBPZmZzZXQgPSB2YWx1ZTsgfVxuXG4gIEBJbnB1dCgnc25hcC1kdXJhdGlvbicpXG4gIGdldCBzbmFwRHVyYXRpb24oKSB7IHJldHVybiB0aGlzLl9zbmFwRHVyYXRpb247IH1cbiAgc2V0IHNuYXBEdXJhdGlvbih2YWx1ZTogbnVtYmVyKSB7IHRoaXMuX3NuYXBEdXJhdGlvbiA9IHZhbHVlOyB9XG5cbiAgY29uc3RydWN0b3IoXG4gICAgQEluamVjdChFbGVtZW50UmVmKSBwcml2YXRlIF9lbGVtZW50UmVmOiBFbGVtZW50UmVmLFxuICAgIEBJbmplY3QoUmVuZGVyZXIyKSBwcml2YXRlIF9yZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIEBJbmplY3QoRE9DVU1FTlQpIHByaXZhdGUgX2RvY3VtZW50OiBhbnlcbiAgKSB7XG4gICAgdGhpcy5zY3JvbGxiYXJXaWR0aCA9IGAke3RoaXMuZ2V0U2Nyb2xsYmFyV2lkdGgoKX1weGA7XG4gIH1cblxuICBuZ09uQ2hhbmdlcygpIHtcbiAgICB0aGlzLnNldFNjcm9sbEJhcigpO1xuXG4gICAgaWYgKHRoaXMueERpc2FibGVkIHx8IHRoaXMuZGlzYWJsZWQpIHtcbiAgICAgIHRoaXMuZGlzYWJsZVNjcm9sbCgneCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmVuYWJsZVNjcm9sbCgneCcpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnlEaXNhYmxlZCB8fCB0aGlzLmRpc2FibGVkKSB7XG4gICAgICB0aGlzLmRpc2FibGVTY3JvbGwoJ3knKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5lbmFibGVTY3JvbGwoJ3knKTtcbiAgICB9XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgLy8gYXV0byBhc3NpZ24gY29tcHV0ZWQgY3NzXG4gICAgdGhpcy5fcmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuX2NvbnRlbnRSZWYubmF0aXZlRWxlbWVudCwgJ2RyYWctc2Nyb2xsJywgJ3RydWUnKTtcblxuICAgIHRoaXMuZGlzcGxheVR5cGUgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudCkuZGlzcGxheSA6ICdibG9jayc7XG5cbiAgICB0aGlzLl9yZW5kZXJlci5zZXRTdHlsZSh0aGlzLl9jb250ZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdkaXNwbGF5JywgdGhpcy5kaXNwbGF5VHlwZSk7XG4gICAgdGhpcy5fcmVuZGVyZXIuc2V0U3R5bGUodGhpcy5fY29udGVudFJlZi5uYXRpdmVFbGVtZW50LCAnd2hpdGVTcGFjZScsICdub1dyYXAnKTtcblxuICAgIC8vIHN0b3JlIGVsZSB3aWR0aCBoZWlnaHQgZm9yIGxhdGVyIHVzZXJcbiAgICB0aGlzLm1hcmtFbERpbWVuc2lvbigpO1xuXG4gICAgdGhpcy5fcmVuZGVyZXIuc2V0U3R5bGUodGhpcy5fY29udGVudFJlZi5uYXRpdmVFbGVtZW50LCAnd2lkdGgnLCB0aGlzLmVsV2lkdGgpO1xuICAgIHRoaXMuX3JlbmRlcmVyLnNldFN0eWxlKHRoaXMuX2NvbnRlbnRSZWYubmF0aXZlRWxlbWVudCwgJ2hlaWdodCcsIHRoaXMuZWxIZWlnaHQpO1xuXG4gICAgaWYgKHRoaXMud3JhcHBlcikge1xuICAgICAgdGhpcy5jaGVja1Njcm9sbGJhcigpO1xuICAgIH1cblxuICAgIHRoaXMuX29uTW91c2VEb3duTGlzdGVuZXIgPSB0aGlzLl9yZW5kZXJlci5saXN0ZW4odGhpcy5fY29udGVudFJlZi5uYXRpdmVFbGVtZW50LCAnbW91c2Vkb3duJywgdGhpcy5vbk1vdXNlRG93bkhhbmRsZXIuYmluZCh0aGlzKSk7XG4gICAgdGhpcy5fb25Ub3VjaFN0YXJ0TGlzdGVuZXIgPSB0aGlzLl9yZW5kZXJlci5saXN0ZW4odGhpcy5fY29udGVudFJlZi5uYXRpdmVFbGVtZW50LCAndG91Y2hzdGFydCcsIHRoaXMub25Nb3VzZURvd25IYW5kbGVyLmJpbmQodGhpcykpO1xuICAgIHRoaXMuX29uU2Nyb2xsTGlzdGVuZXIgPSB0aGlzLl9yZW5kZXJlci5saXN0ZW4odGhpcy5fY29udGVudFJlZi5uYXRpdmVFbGVtZW50LCAnc2Nyb2xsJywgdGhpcy5vblNjcm9sbEhhbmRsZXIuYmluZCh0aGlzKSk7XG4gICAgdGhpcy5fb25Ub3VjaEVuZExpc3RlbmVyID0gdGhpcy5fcmVuZGVyZXIubGlzdGVuKHRoaXMuX2NvbnRlbnRSZWYubmF0aXZlRWxlbWVudCwgJ3RvdWNoZW5kJywgdGhpcy5vbk1vdXNlVXBIYW5kbGVyLmJpbmQodGhpcykpO1xuICAgIC8vIHByZXZlbnQgRmlyZWZveCBmcm9tIGRyYWdnaW5nIGltYWdlc1xuICAgIHRoaXMuX29uRHJhZ1N0YXJ0TGlzdGVuZXIgPSB0aGlzLl9yZW5kZXJlci5saXN0ZW4oJ2RvY3VtZW50JywgJ2RyYWdzdGFydCcsIChlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSk7XG4gICAgdGhpcy5jaGVja05hdlN0YXR1cygpO1xuICAgIHRoaXMuZHNJbml0aWFsaXplZC5lbWl0KCk7XG4gICAgdGhpcy5hZGp1c3RNYXJnaW5Ub0xhc3RDaGlsZCgpO1xuICB9XG5cbiAgbmdBZnRlclZpZXdDaGVja2VkKCkge1xuICAgIC8vIGF2b2lkIGV4dHJhIGNoZWNrc1xuICAgIGlmICh0aGlzLl9jaGlsZHJlblsnX3Jlc3VsdHMnXS5sZW5ndGggIT09IHRoaXMucHJldkNoaWxkcmVuTGVuZ3RoKSB7XG5cbiAgICAgIHRoaXMubWFya0VsRGltZW5zaW9uKCk7XG4gICAgICB0aGlzLmNoZWNrU2Nyb2xsYmFyKCk7XG4gICAgICB0aGlzLnByZXZDaGlsZHJlbkxlbmd0aCA9IHRoaXMuX2NoaWxkcmVuWydfcmVzdWx0cyddLmxlbmd0aDtcbiAgICAgIHRoaXMuY2hlY2tOYXZTdGF0dXMoKTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLl9yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy5fY29udGVudFJlZi5uYXRpdmVFbGVtZW50LCAnZHJhZy1zY3JvbGwnLCAnZmFsc2UnKTtcbiAgICBpZiAodGhpcy5fb25Nb3VzZURvd25MaXN0ZW5lcikge1xuICAgICAgdGhpcy5fb25Nb3VzZURvd25MaXN0ZW5lciA9IHRoaXMuX29uTW91c2VEb3duTGlzdGVuZXIoKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuX29uVG91Y2hTdGFydExpc3RlbmVyKSB7XG4gICAgICB0aGlzLl9vblRvdWNoU3RhcnRMaXN0ZW5lciA9IHRoaXMuX29uVG91Y2hTdGFydExpc3RlbmVyKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLl9vblNjcm9sbExpc3RlbmVyKSB7XG4gICAgICB0aGlzLl9vblNjcm9sbExpc3RlbmVyID0gdGhpcy5fb25TY3JvbGxMaXN0ZW5lcigpO1xuICAgIH1cbiAgICBpZiAodGhpcy5fb25Ub3VjaEVuZExpc3RlbmVyKSB7XG4gICAgICB0aGlzLl9vblRvdWNoRW5kTGlzdGVuZXIgPSB0aGlzLl9vblRvdWNoRW5kTGlzdGVuZXIoKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuX29uRHJhZ1N0YXJ0TGlzdGVuZXIpIHtcbiAgICAgIHRoaXMuX29uRHJhZ1N0YXJ0TGlzdGVuZXIgPSB0aGlzLl9vbkRyYWdTdGFydExpc3RlbmVyKCk7XG4gICAgfVxuICB9XG5cbiAgb25Nb3VzZU1vdmVIYW5kbGVyKGV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgdGhpcy5vbk1vdXNlTW92ZShldmVudCk7XG4gIH1cblxuICBvbk1vdXNlTW92ZShldmVudDogTW91c2VFdmVudCB8IFRvdWNoRXZlbnQpIHtcbiAgICBpZiAodGhpcy5pc1ByZXNzZWQgJiYgIXRoaXMuZGlzYWJsZWQpIHtcbiAgICAgIGNvbnN0IGlzVG91Y2hFdmVudCA9IGV2ZW50LnR5cGUgPT09ICd0b3VjaG1vdmUnO1xuXG4gICAgICAvLyBXb3JrYXJvdW5kIGZvciBwcmV2ZW50IHNjcm9sbCBzdHVjayBpZiBicm93c2VyIGxvc3QgZm9jdXNcbiAgICAgIGlmICghaXNUb3VjaEV2ZW50KSB7XG4gICAgICAgIGNvbnN0IG1vdXNlRXZlbnQgPSBldmVudCBhcyBNb3VzZUV2ZW50O1xuICAgICAgICAvLyBNb3VzZUV2ZW50LmJ1dHRvbnMgbm90IHN1cHBvcnQgYnkgU2FmYXJpXG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpkZXByZWNhdGlvblxuICAgICAgICBpZiAoIW1vdXNlRXZlbnQuYnV0dG9ucyAmJiAhbW91c2VFdmVudC53aGljaCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLm9uTW91c2VVcEhhbmRsZXIobW91c2VFdmVudCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gLy8gRHJhZyBYXG4gICAgICBpZiAoIXRoaXMueERpc2FibGVkICYmICF0aGlzLmRyYWdEaXNhYmxlZCkge1xuICAgICAgICBjb25zdCBjbGllbnRYID0gaXNUb3VjaEV2ZW50ID8gKGV2ZW50IGFzIFRvdWNoRXZlbnQpLnRvdWNoZXNbMF0uY2xpZW50WCA6IChldmVudCBhcyBNb3VzZUV2ZW50KS5jbGllbnRYO1xuICAgICAgICB0aGlzLl9jb250ZW50UmVmLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsTGVmdCA9XG4gICAgICAgICAgdGhpcy5fY29udGVudFJlZi5uYXRpdmVFbGVtZW50LnNjcm9sbExlZnQgLSBjbGllbnRYICsgdGhpcy5kb3duWDtcbiAgICAgICAgdGhpcy5kb3duWCA9IGNsaWVudFg7XG4gICAgICB9XG5cbiAgICAgIC8vIERyYWcgWVxuICAgICAgaWYgKCF0aGlzLnlEaXNhYmxlZCAmJiAhdGhpcy5kcmFnRGlzYWJsZWQpIHtcbiAgICAgICAgY29uc3QgY2xpZW50WSA9IGlzVG91Y2hFdmVudCA/IChldmVudCBhcyBUb3VjaEV2ZW50KS50b3VjaGVzWzBdLmNsaWVudFkgOiAoZXZlbnQgYXMgTW91c2VFdmVudCkuY2xpZW50WTtcbiAgICAgICAgdGhpcy5fY29udGVudFJlZi5uYXRpdmVFbGVtZW50LnNjcm9sbFRvcCA9XG4gICAgICAgICAgdGhpcy5fY29udGVudFJlZi5uYXRpdmVFbGVtZW50LnNjcm9sbFRvcCAtIGNsaWVudFkgKyB0aGlzLmRvd25ZO1xuICAgICAgICB0aGlzLmRvd25ZID0gY2xpZW50WTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBvbk1vdXNlRG93bkhhbmRsZXIoZXZlbnQ6IE1vdXNlRXZlbnQgfCBUb3VjaEV2ZW50KSB7XG4gICAgY29uc3QgZHJhZ1Njcm9sbEl0ZW06IERyYWdTY3JvbGxJdGVtRGlyZWN0aXZlIHwgbnVsbCA9IHRoaXMubG9jYXRlRHJhZ1Njcm9sbEl0ZW0oZXZlbnQudGFyZ2V0IGFzIEVsZW1lbnQpO1xuICAgIGlmIChkcmFnU2Nyb2xsSXRlbSAmJiBkcmFnU2Nyb2xsSXRlbS5kcmFnRGlzYWJsZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBpc1RvdWNoRXZlbnQgPSBldmVudC50eXBlID09PSAndG91Y2hzdGFydCc7XG5cbiAgICB0aGlzLl9zdGFydEdsb2JhbExpc3RlbmluZyhpc1RvdWNoRXZlbnQpO1xuICAgIHRoaXMuaXNQcmVzc2VkID0gdHJ1ZTtcblxuICAgIGlmIChpc1RvdWNoRXZlbnQpIHtcbiAgICAgIGNvbnN0IHRvdWNoRXZlbnQgPSBldmVudCBhcyBUb3VjaEV2ZW50O1xuICAgICAgdGhpcy5kb3duWCA9IHRvdWNoRXZlbnQudG91Y2hlc1swXS5jbGllbnRYO1xuICAgICAgdGhpcy5kb3duWSA9IHRvdWNoRXZlbnQudG91Y2hlc1swXS5jbGllbnRZO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBtb3VzZUV2ZW50ID0gZXZlbnQgYXMgTW91c2VFdmVudDtcbiAgICAgIHRoaXMuZG93blggPSBtb3VzZUV2ZW50LmNsaWVudFg7XG4gICAgICB0aGlzLmRvd25ZID0gbW91c2VFdmVudC5jbGllbnRZO1xuICAgIH1cblxuXG4gICAgY2xlYXJUaW1lb3V0KHRoaXMuc2Nyb2xsVG9UaW1lciBhcyBudW1iZXIpO1xuICB9XG5cbiAgb25TY3JvbGxIYW5kbGVyKCkge1xuICAgIHRoaXMuY2hlY2tOYXZTdGF0dXMoKTtcbiAgICBpZiAoIXRoaXMuaXNQcmVzc2VkICYmICF0aGlzLmlzQW5pbWF0aW5nICYmICF0aGlzLnNuYXBEaXNhYmxlZCkge1xuICAgICAgdGhpcy5pc1Njcm9sbGluZyA9IHRydWU7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5zY3JvbGxUaW1lciBhcyBudW1iZXIpO1xuICAgICAgdGhpcy5zY3JvbGxUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLmlzU2Nyb2xsaW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMubG9jYXRlQ3VycmVudEluZGV4KHRydWUpO1xuICAgICAgfSwgNTAwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5sb2NhdGVDdXJyZW50SW5kZXgoKTtcbiAgICB9XG4gIH1cblxuICBvbk1vdXNlVXBIYW5kbGVyKGV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgaWYgKHRoaXMuaXNQcmVzc2VkKSB7XG4gICAgICB0aGlzLmlzUHJlc3NlZCA9IGZhbHNlO1xuICAgICAgaWYgKCF0aGlzLnNuYXBEaXNhYmxlZCkge1xuICAgICAgICB0aGlzLmxvY2F0ZUN1cnJlbnRJbmRleCh0cnVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubG9jYXRlQ3VycmVudEluZGV4KCk7XG4gICAgICB9XG4gICAgICB0aGlzLl9zdG9wR2xvYmFsTGlzdGVuaW5nKCk7XG4gICAgfVxuICB9XG5cbiAgLypcbiAgICogTmF2IGJ1dHRvblxuICAgKi9cbiAgbW92ZUxlZnQoKSB7XG4gICAgaWYgKCh0aGlzLmN1cnJJbmRleCAhPT0gMCB8fCB0aGlzLnNuYXBEaXNhYmxlZCkpIHtcbiAgICAgIHRoaXMuY3VyckluZGV4LS07XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5zY3JvbGxUb1RpbWVyIGFzIG51bWJlcik7XG4gICAgICB0aGlzLnNjcm9sbFRvKHRoaXMuX2NvbnRlbnRSZWYubmF0aXZlRWxlbWVudCwgdGhpcy50b0NoaWxkcmVuTG9jYXRpb24oKSwgdGhpcy5zbmFwRHVyYXRpb24pO1xuICAgIH1cbiAgfVxuXG4gIG1vdmVSaWdodCgpIHtcbiAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLndyYXBwZXIgfHwgdGhpcy5wYXJlbnROb2RlO1xuICAgIGNvbnN0IGNvbnRhaW5lcldpZHRoID0gY29udGFpbmVyID8gY29udGFpbmVyLmNsaWVudFdpZHRoIDogMDtcblxuICAgIGlmICghdGhpcy5pc1Njcm9sbFJlYWNoZXNSaWdodEVuZCgpICYmIHRoaXMuY3VyckluZGV4IDwgdGhpcy5tYXhpbXVtSW5kZXgoY29udGFpbmVyV2lkdGgsIHRoaXMuX2NoaWxkcmVuKSkge1xuICAgICAgdGhpcy5jdXJySW5kZXgrKztcbiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnNjcm9sbFRvVGltZXIgYXMgbnVtYmVyKTtcbiAgICAgIHRoaXMuc2Nyb2xsVG8odGhpcy5fY29udGVudFJlZi5uYXRpdmVFbGVtZW50LCB0aGlzLnRvQ2hpbGRyZW5Mb2NhdGlvbigpLCB0aGlzLnNuYXBEdXJhdGlvbik7XG4gICAgfVxuICB9XG5cbiAgbW92ZVRvKGluZGV4OiBudW1iZXIpIHtcbiAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLndyYXBwZXIgfHwgdGhpcy5wYXJlbnROb2RlO1xuICAgIGNvbnN0IGNvbnRhaW5lcldpZHRoID0gY29udGFpbmVyID8gY29udGFpbmVyLmNsaWVudFdpZHRoIDogMDtcbiAgICBpZiAoXG4gICAgICBpbmRleCA+PSAwICYmXG4gICAgICBpbmRleCAhPT0gdGhpcy5jdXJySW5kZXggJiZcbiAgICAgIHRoaXMuY3VyckluZGV4IDw9IHRoaXMubWF4aW11bUluZGV4KGNvbnRhaW5lcldpZHRoLCB0aGlzLl9jaGlsZHJlbilcbiAgICApIHtcbiAgICAgIHRoaXMuY3VyckluZGV4ID0gTWF0aC5taW4oaW5kZXgsIHRoaXMubWF4aW11bUluZGV4KGNvbnRhaW5lcldpZHRoLCB0aGlzLl9jaGlsZHJlbikpO1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuc2Nyb2xsVG9UaW1lciBhcyBudW1iZXIpO1xuICAgICAgdGhpcy5zY3JvbGxUbyh0aGlzLl9jb250ZW50UmVmLm5hdGl2ZUVsZW1lbnQsIHRoaXMudG9DaGlsZHJlbkxvY2F0aW9uKCksIHRoaXMuc25hcER1cmF0aW9uKTtcbiAgICB9XG4gIH1cblxuICBjaGVja05hdlN0YXR1cygpIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGNvbnN0IG9ubHlPbmVJdGVtID0gQm9vbGVhbih0aGlzLl9jaGlsZHJlblsnX3Jlc3VsdHMnXS5sZW5ndGggPD0gMSk7XG4gICAgICBjb25zdCBjb250YWluZXJJc0xhcmdlclRoYW5Db250ZW50ID0gQm9vbGVhbih0aGlzLl9jb250ZW50UmVmLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsV2lkdGggPD1cbiAgICAgICAgdGhpcy5fY29udGVudFJlZi5uYXRpdmVFbGVtZW50LmNsaWVudFdpZHRoKTtcbiAgICAgIGlmIChvbmx5T25lSXRlbSB8fCBjb250YWluZXJJc0xhcmdlclRoYW5Db250ZW50KSB7XG4gICAgICAgIC8vIG9ubHkgb25lIGVsZW1lbnRcbiAgICAgICAgdGhpcy5yZWFjaGVzTGVmdEJvdW5kLmVtaXQodHJ1ZSk7XG4gICAgICAgIHRoaXMucmVhY2hlc1JpZ2h0Qm91bmQuZW1pdCh0cnVlKTtcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5pc1Njcm9sbFJlYWNoZXNSaWdodEVuZCgpKSB7XG4gICAgICAgIC8vIHJlYWNoZWQgcmlnaHQgZW5kXG4gICAgICAgIHRoaXMucmVhY2hlc0xlZnRCb3VuZC5lbWl0KGZhbHNlKTtcbiAgICAgICAgdGhpcy5yZWFjaGVzUmlnaHRCb3VuZC5lbWl0KHRydWUpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLl9jb250ZW50UmVmLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsTGVmdCA9PT0gMCAmJlxuICAgICAgICB0aGlzLl9jb250ZW50UmVmLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsV2lkdGggPiB0aGlzLl9jb250ZW50UmVmLm5hdGl2ZUVsZW1lbnQuY2xpZW50V2lkdGgpIHtcbiAgICAgICAgLy8gcmVhY2hlZCBsZWZ0IGVuZFxuICAgICAgICB0aGlzLnJlYWNoZXNMZWZ0Qm91bmQuZW1pdCh0cnVlKTtcbiAgICAgICAgdGhpcy5yZWFjaGVzUmlnaHRCb3VuZC5lbWl0KGZhbHNlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGluIHRoZSBtaWRkbGVcbiAgICAgICAgdGhpcy5yZWFjaGVzTGVmdEJvdW5kLmVtaXQoZmFsc2UpO1xuICAgICAgICB0aGlzLnJlYWNoZXNSaWdodEJvdW5kLmVtaXQoZmFsc2UpO1xuICAgICAgfVxuICAgIH0sIDApO1xuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignd2hlZWwnLCBbJyRldmVudCddKVxuICBwdWJsaWMgb25XaGVlbChldmVudDogV2hlZWxFdmVudCkge1xuICAgIGlmICh0aGlzLl94V2hlZWxFbmFibGVkKSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICBpZiAodGhpcy5fc25hcERpc2FibGVkKSB7XG4gICAgICAgIHRoaXMuX2NvbnRlbnRSZWYubmF0aXZlRWxlbWVudC5zY3JvbGxCeShldmVudC5kZWx0YVksIDApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGV2ZW50LmRlbHRhWSA8IDApIHtcbiAgICAgICAgICB0aGlzLm1vdmVMZWZ0KCk7XG4gICAgICAgIH0gZWxzZSBpZiAoZXZlbnQuZGVsdGFZID4gMCkge1xuICAgICAgICAgIHRoaXMubW92ZVJpZ2h0KCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCd3aW5kb3c6cmVzaXplJylcbiAgcHVibGljIG9uV2luZG93UmVzaXplKCkge1xuICAgIHRoaXMucmVmcmVzaFdyYXBwZXJEaW1lbnNpb25zKCk7XG4gIH1cblxuICBwcml2YXRlIF9zdGFydEdsb2JhbExpc3RlbmluZyhpc1RvdWNoRXZlbnQ6IGJvb2xlYW4pIHtcbiAgICBpZiAoIXRoaXMuX29uTW91c2VNb3ZlTGlzdGVuZXIpIHtcbiAgICAgIGNvbnN0IGV2ZW50TmFtZSA9IGlzVG91Y2hFdmVudCA/ICd0b3VjaG1vdmUnIDogJ21vdXNlbW92ZSc7XG4gICAgICB0aGlzLl9vbk1vdXNlTW92ZUxpc3RlbmVyID0gdGhpcy5fcmVuZGVyZXIubGlzdGVuKCdkb2N1bWVudCcsIGV2ZW50TmFtZSwgdGhpcy5vbk1vdXNlTW92ZUhhbmRsZXIuYmluZCh0aGlzKSk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLl9vbk1vdXNlVXBMaXN0ZW5lcikge1xuICAgICAgY29uc3QgZXZlbnROYW1lID0gaXNUb3VjaEV2ZW50ID8gJ3RvdWNoZW5kJyA6ICdtb3VzZXVwJztcbiAgICAgIHRoaXMuX29uTW91c2VVcExpc3RlbmVyID0gdGhpcy5fcmVuZGVyZXIubGlzdGVuKCdkb2N1bWVudCcsIGV2ZW50TmFtZSwgdGhpcy5vbk1vdXNlVXBIYW5kbGVyLmJpbmQodGhpcykpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX3N0b3BHbG9iYWxMaXN0ZW5pbmcoKSB7XG4gICAgaWYgKHRoaXMuX29uTW91c2VNb3ZlTGlzdGVuZXIpIHtcbiAgICAgIHRoaXMuX29uTW91c2VNb3ZlTGlzdGVuZXIgPSB0aGlzLl9vbk1vdXNlTW92ZUxpc3RlbmVyKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuX29uTW91c2VVcExpc3RlbmVyKSB7XG4gICAgICB0aGlzLl9vbk1vdXNlVXBMaXN0ZW5lciA9IHRoaXMuX29uTW91c2VVcExpc3RlbmVyKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBkaXNhYmxlU2Nyb2xsKGF4aXM6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuX3JlbmRlcmVyLnNldFN0eWxlKHRoaXMuX2NvbnRlbnRSZWYubmF0aXZlRWxlbWVudCwgYG92ZXJmbG93LSR7YXhpc31gLCAnaGlkZGVuJyk7XG4gIH1cblxuICBwcml2YXRlIGVuYWJsZVNjcm9sbChheGlzOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLl9yZW5kZXJlci5zZXRTdHlsZSh0aGlzLl9jb250ZW50UmVmLm5hdGl2ZUVsZW1lbnQsIGBvdmVyZmxvdy0ke2F4aXN9YCwgJ2F1dG8nKTtcbiAgfVxuXG4gIHByaXZhdGUgaGlkZVNjcm9sbGJhcigpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5fY29udGVudFJlZi5uYXRpdmVFbGVtZW50LnN0eWxlLmRpc3BsYXkgIT09ICdub25lJyAmJiAhdGhpcy53cmFwcGVyKSB7XG4gICAgICB0aGlzLnBhcmVudE5vZGUgPSB0aGlzLl9jb250ZW50UmVmLm5hdGl2ZUVsZW1lbnQucGFyZW50Tm9kZTtcblxuICAgICAgLy8gY3JlYXRlIGNvbnRhaW5lciBlbGVtZW50XG4gICAgICB0aGlzLndyYXBwZXIgPSB0aGlzLl9yZW5kZXJlci5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIHRoaXMuX3JlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLndyYXBwZXIsICdjbGFzcycsICdkcmFnLXNjcm9sbC13cmFwcGVyJyk7XG4gICAgICB0aGlzLl9yZW5kZXJlci5hZGRDbGFzcyh0aGlzLndyYXBwZXIsICdkcmFnLXNjcm9sbC1jb250YWluZXInKTtcblxuICAgICAgdGhpcy5yZWZyZXNoV3JhcHBlckRpbWVuc2lvbnMoKTtcblxuICAgICAgdGhpcy5fcmVuZGVyZXIuc2V0U3R5bGUodGhpcy53cmFwcGVyLCAnb3ZlcmZsb3cnLCAnaGlkZGVuJyk7XG5cbiAgICAgIHRoaXMuX3JlbmRlcmVyLnNldFN0eWxlKHRoaXMuX2NvbnRlbnRSZWYubmF0aXZlRWxlbWVudCwgJ3dpZHRoJywgYGNhbGMoMTAwJSArICR7dGhpcy5zY3JvbGxiYXJXaWR0aH0pYCk7XG4gICAgICB0aGlzLl9yZW5kZXJlci5zZXRTdHlsZSh0aGlzLl9jb250ZW50UmVmLm5hdGl2ZUVsZW1lbnQsICdoZWlnaHQnLCBgY2FsYygxMDAlICsgJHt0aGlzLnNjcm9sbGJhcldpZHRofSlgKTtcblxuICAgICAgLy8gQXBwZW5kIGNvbnRhaW5lciBlbGVtZW50IHRvIGNvbXBvbmVudCBlbGVtZW50LlxuICAgICAgdGhpcy5fcmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LCB0aGlzLndyYXBwZXIpO1xuXG4gICAgICAvLyBBcHBlbmQgY29udGVudCBlbGVtZW50IHRvIGNvbnRhaW5lciBlbGVtZW50LlxuICAgICAgdGhpcy5fcmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy53cmFwcGVyLCB0aGlzLl9jb250ZW50UmVmLm5hdGl2ZUVsZW1lbnQpO1xuXG4gICAgICB0aGlzLmFkanVzdE1hcmdpblRvTGFzdENoaWxkKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzaG93U2Nyb2xsYmFyKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLndyYXBwZXIpIHtcbiAgICAgIHRoaXMuX3JlbmRlcmVyLnNldFN0eWxlKHRoaXMuX2NvbnRlbnRSZWYubmF0aXZlRWxlbWVudCwgJ3dpZHRoJywgJzEwMCUnKTtcbiAgICAgIHRoaXMuX3JlbmRlcmVyLnNldFN0eWxlKHRoaXMuX2NvbnRlbnRSZWYubmF0aXZlRWxlbWVudCwgJ2hlaWdodCcsIHRoaXMud3JhcHBlci5zdHlsZS5oZWlnaHQpO1xuICAgICAgaWYgKHRoaXMucGFyZW50Tm9kZSAhPT0gbnVsbCkge1xuICAgICAgICB0aGlzLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy53cmFwcGVyKTtcbiAgICAgICAgdGhpcy5wYXJlbnROb2RlLmFwcGVuZENoaWxkKHRoaXMuX2NvbnRlbnRSZWYubmF0aXZlRWxlbWVudCk7XG4gICAgICB9XG4gICAgICB0aGlzLndyYXBwZXIgPSBudWxsO1xuXG4gICAgICB0aGlzLmFkanVzdE1hcmdpblRvTGFzdENoaWxkKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjaGVja1Njcm9sbGJhcigpIHtcbiAgICBpZiAodGhpcy5fY29udGVudFJlZi5uYXRpdmVFbGVtZW50LnNjcm9sbFdpZHRoIDw9IHRoaXMuX2NvbnRlbnRSZWYubmF0aXZlRWxlbWVudC5jbGllbnRXaWR0aCkge1xuICAgICAgdGhpcy5fcmVuZGVyZXIuc2V0U3R5bGUodGhpcy5fY29udGVudFJlZi5uYXRpdmVFbGVtZW50LCAnaGVpZ2h0JywgJzEwMCUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fcmVuZGVyZXIuc2V0U3R5bGUodGhpcy5fY29udGVudFJlZi5uYXRpdmVFbGVtZW50LCAnaGVpZ2h0JywgYGNhbGMoMTAwJSArICR7dGhpcy5zY3JvbGxiYXJXaWR0aH0pYCk7XG4gICAgfVxuICAgIGlmICh0aGlzLl9jb250ZW50UmVmLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsSGVpZ2h0IDw9IHRoaXMuX2NvbnRlbnRSZWYubmF0aXZlRWxlbWVudC5jbGllbnRIZWlnaHQpIHtcbiAgICAgIHRoaXMuX3JlbmRlcmVyLnNldFN0eWxlKHRoaXMuX2NvbnRlbnRSZWYubmF0aXZlRWxlbWVudCwgJ3dpZHRoJywgJzEwMCUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fcmVuZGVyZXIuc2V0U3R5bGUodGhpcy5fY29udGVudFJlZi5uYXRpdmVFbGVtZW50LCAnd2lkdGgnLCBgY2FsYygxMDAlICsgJHt0aGlzLnNjcm9sbGJhcldpZHRofSlgKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldFNjcm9sbEJhcigpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5zY3JvbGxiYXJIaWRkZW4pIHtcbiAgICAgIHRoaXMuaGlkZVNjcm9sbGJhcigpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNob3dTY3JvbGxiYXIoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldFNjcm9sbGJhcldpZHRoKCk6IG51bWJlciB7XG4gICAgLyoqXG4gICAgICogQnJvd3NlciBTY3JvbGxiYXIgV2lkdGhzICgyMDE2KVxuICAgICAqIE9TWCAoQ2hyb21lLCBTYWZhcmksIEZpcmVmb3gpIC0gMTVweFxuICAgICAqIFdpbmRvd3MgWFAgKElFNywgQ2hyb21lLCBGaXJlZm94KSAtIDE3cHhcbiAgICAgKiBXaW5kb3dzIDcgKElFMTAsIElFMTEsIENocm9tZSwgRmlyZWZveCkgLSAxN3B4XG4gICAgICogV2luZG93cyA4LjEgKElFMTEsIENocm9tZSwgRmlyZWZveCkgLSAxN3B4XG4gICAgICogV2luZG93cyAxMCAoSUUxMSwgQ2hyb21lLCBGaXJlZm94KSAtIDE3cHhcbiAgICAgKiBXaW5kb3dzIDEwIChFZGdlIDEyLzEzKSAtIDEycHhcbiAgICAgKi9cbiAgICBjb25zdCBvdXRlciA9IHRoaXMuX3JlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHRoaXMuX3JlbmRlcmVyLnNldFN0eWxlKG91dGVyLCAndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgICB0aGlzLl9yZW5kZXJlci5zZXRTdHlsZShvdXRlciwgJ3dpZHRoJywgJzEwMHB4Jyk7XG4gICAgdGhpcy5fcmVuZGVyZXIuc2V0U3R5bGUob3V0ZXIsICdtc092ZXJmbG93U3R5bGUnLCAnc2Nyb2xsYmFyJyk7ICAvLyBuZWVkZWQgZm9yIFdpbkpTIGFwcHNcbiAgICAvLyBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG91dGVyKTtcbiAgICB0aGlzLl9yZW5kZXJlci5hcHBlbmRDaGlsZCh0aGlzLl9kb2N1bWVudC5ib2R5LCBvdXRlcik7XG4gICAgLy8gdGhpcy5fcmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy5fcmVuZGVyZXIuc2VsZWN0Um9vdEVsZW1lbnQoJ2JvZHknKSwgb3V0ZXIpO1xuICAgIGNvbnN0IHdpZHRoTm9TY3JvbGwgPSBvdXRlci5vZmZzZXRXaWR0aDtcbiAgICAvLyBmb3JjZSBzY3JvbGxiYXJzXG4gICAgdGhpcy5fcmVuZGVyZXIuc2V0U3R5bGUob3V0ZXIsICdvdmVyZmxvdycsICdzY3JvbGwnKTtcblxuICAgIC8vIGFkZCBpbm5lcmRpdlxuICAgIGNvbnN0IGlubmVyID0gdGhpcy5fcmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgdGhpcy5fcmVuZGVyZXIuc2V0U3R5bGUoaW5uZXIsICd3aWR0aCcsICcxMDAlJyk7XG4gICAgdGhpcy5fcmVuZGVyZXIuYXBwZW5kQ2hpbGQob3V0ZXIsIGlubmVyKTtcblxuICAgIGNvbnN0IHdpZHRoV2l0aFNjcm9sbCA9IGlubmVyLm9mZnNldFdpZHRoO1xuXG4gICAgLy8gcmVtb3ZlIGRpdnNcbiAgICB0aGlzLl9yZW5kZXJlci5yZW1vdmVDaGlsZCh0aGlzLl9kb2N1bWVudC5ib2R5LCBvdXRlcik7XG5cbiAgICAvKipcbiAgICAgKiBTY3JvbGxiYXIgd2lkdGggd2lsbCBiZSAwIG9uIE1hYyBPUyB3aXRoIHRoZVxuICAgICAqIGRlZmF1bHQgXCJPbmx5IHNob3cgc2Nyb2xsYmFycyB3aGVuIHNjcm9sbGluZ1wiIHNldHRpbmcgKFlvc2VtaXRlIGFuZCB1cCkuXG4gICAgICogc2V0dGluZyBkZWZhdWx0IHdpZHRoIHRvIDIwO1xuICAgICAqL1xuICAgIHJldHVybiB3aWR0aE5vU2Nyb2xsIC0gd2lkdGhXaXRoU2Nyb2xsIHx8IDIwO1xuICB9XG5cbiAgcHJpdmF0ZSByZWZyZXNoV3JhcHBlckRpbWVuc2lvbnMoKSB7XG4gICAgaWYgKHRoaXMud3JhcHBlcikge1xuICAgICAgdGhpcy5fcmVuZGVyZXIuc2V0U3R5bGUodGhpcy53cmFwcGVyLCAnd2lkdGgnLCAnMTAwJScpO1xuICAgICAgdGhpcy5fcmVuZGVyZXIuc2V0U3R5bGUodGhpcy53cmFwcGVyLCAnaGVpZ2h0JywgdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LnN0eWxlLmhlaWdodFxuICAgICAgICB8fCB0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQub2Zmc2V0SGVpZ2h0ICsgJ3B4Jyk7XG4gICAgfVxuICB9XG5cbiAgLypcbiAgKiBUaGUgYmVsb3cgc29sdXRpb24gaXMgaGVhdmlseSBpbnNwaXJlZCBmcm9tXG4gICogaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vYW5kam9zaC82NzY0OTM5XG4gICovXG4gIHByaXZhdGUgc2Nyb2xsVG8oZWxlbWVudDogRWxlbWVudCwgdG86IG51bWJlciwgZHVyYXRpb246IG51bWJlcikge1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzO1xuICAgIHNlbGYuaXNBbmltYXRpbmcgPSB0cnVlO1xuICAgIGNvbnN0IHN0YXJ0ID0gZWxlbWVudC5zY3JvbGxMZWZ0LFxuICAgICAgY2hhbmdlID0gdG8gLSBzdGFydCAtIHRoaXMuc25hcE9mZnNldCxcbiAgICAgIGluY3JlbWVudCA9IDIwO1xuICAgIGxldCBjdXJyZW50VGltZSA9IDA7XG5cbiAgICAvLyB0ID0gY3VycmVudCB0aW1lXG4gICAgLy8gYiA9IHN0YXJ0IHZhbHVlXG4gICAgLy8gYyA9IGNoYW5nZSBpbiB2YWx1ZVxuICAgIC8vIGQgPSBkdXJhdGlvblxuICAgIGNvbnN0IGVhc2VJbk91dFF1YWQgPSBmdW5jdGlvbiAodDogbnVtYmVyLCBiOiBudW1iZXIsIGM6IG51bWJlciwgZDogbnVtYmVyKSB7XG4gICAgICB0IC89IGQgLyAyO1xuICAgICAgaWYgKHQgPCAxKSB7XG4gICAgICAgIHJldHVybiBjIC8gMiAqIHQgKiB0ICsgYjtcbiAgICAgIH1cbiAgICAgIHQtLTtcbiAgICAgIHJldHVybiAtYyAvIDIgKiAodCAqICh0IC0gMikgLSAxKSArIGI7XG4gICAgfTtcblxuICAgIGNvbnN0IGFuaW1hdGVTY3JvbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBjdXJyZW50VGltZSArPSBpbmNyZW1lbnQ7XG4gICAgICBlbGVtZW50LnNjcm9sbExlZnQgPSBlYXNlSW5PdXRRdWFkKGN1cnJlbnRUaW1lLCBzdGFydCwgY2hhbmdlLCBkdXJhdGlvbik7XG4gICAgICBpZiAoY3VycmVudFRpbWUgPCBkdXJhdGlvbikge1xuICAgICAgICBzZWxmLnNjcm9sbFRvVGltZXIgPSBzZXRUaW1lb3V0KGFuaW1hdGVTY3JvbGwsIGluY3JlbWVudCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBydW4gb25lIG1vcmUgZnJhbWUgdG8gbWFrZSBzdXJlIHRoZSBhbmltYXRpb24gaXMgZnVsbHkgZmluaXNoZWRcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgc2VsZi5pc0FuaW1hdGluZyA9IGZhbHNlO1xuICAgICAgICAgIHNlbGYuc25hcEFuaW1hdGlvbkZpbmlzaGVkLmVtaXQoc2VsZi5jdXJySW5kZXgpO1xuICAgICAgICB9LCBpbmNyZW1lbnQpO1xuICAgICAgfVxuICAgIH07XG4gICAgYW5pbWF0ZVNjcm9sbCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBsb2NhdGVDdXJyZW50SW5kZXgoc25hcD86IGJvb2xlYW4pIHtcbiAgICB0aGlzLmN1cnJlbnRDaGlsZFdpZHRoKChjdXJyZW50Q2hpbGRXaWR0aCwgbmV4dENoaWxkcmVuV2lkdGgsIGNoaWxkcmVuV2lkdGgsIGlkeDogbnVtYmVyLCBzdG9wKSA9PiB7XG4gICAgICBpZiAoXG4gICAgICAgICh0aGlzLl9jb250ZW50UmVmLm5hdGl2ZUVsZW1lbnQuc2Nyb2xsTGVmdCA+PSBjaGlsZHJlbldpZHRoICYmXG4gICAgICAgICAgdGhpcy5fY29udGVudFJlZi5uYXRpdmVFbGVtZW50LnNjcm9sbExlZnQgPD0gbmV4dENoaWxkcmVuV2lkdGgpXG4gICAgICApIHtcbiAgICAgICAgaWYgKG5leHRDaGlsZHJlbldpZHRoIC0gdGhpcy5fY29udGVudFJlZi5uYXRpdmVFbGVtZW50LnNjcm9sbExlZnQgPiBjdXJyZW50Q2hpbGRXaWR0aCAvIDIgJiYgIXRoaXMuaXNTY3JvbGxSZWFjaGVzUmlnaHRFbmQoKSkge1xuICAgICAgICAgIC8vIHJvbGwgYmFjayBzY3JvbGxpbmdcbiAgICAgICAgICBpZiAoIXRoaXMuaXNBbmltYXRpbmcpIHtcbiAgICAgICAgICAgIHRoaXMuY3VyckluZGV4ID0gaWR4O1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoc25hcCkge1xuICAgICAgICAgICAgdGhpcy5zY3JvbGxUbyh0aGlzLl9jb250ZW50UmVmLm5hdGl2ZUVsZW1lbnQsIGNoaWxkcmVuV2lkdGgsIHRoaXMuc25hcER1cmF0aW9uKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gZm9yd2FyZCBzY3JvbGxpbmdcbiAgICAgICAgICBpZiAoIXRoaXMuaXNBbmltYXRpbmcpIHtcbiAgICAgICAgICAgIHRoaXMuY3VyckluZGV4ID0gaWR4ICsgMTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHNuYXApIHtcbiAgICAgICAgICAgIHRoaXMuc2Nyb2xsVG8odGhpcy5fY29udGVudFJlZi5uYXRpdmVFbGVtZW50LCBjaGlsZHJlbldpZHRoICsgY3VycmVudENoaWxkV2lkdGgsIHRoaXMuc25hcER1cmF0aW9uKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc3RvcCgpO1xuICAgICAgfSBlbHNlIGlmICgoaWR4ICsgMSkgPT09ICh0aGlzLl9jaGlsZHJlblsnX3Jlc3VsdHMnXS5sZW5ndGggLSAxKSkge1xuICAgICAgICAvLyByZWFjaGVzIGxhc3QgaW5kZXhcbiAgICAgICAgaWYgKCF0aGlzLmlzQW5pbWF0aW5nKSB7XG4gICAgICAgICAgdGhpcy5jdXJySW5kZXggPSBpZHggKyAxO1xuICAgICAgICB9XG4gICAgICAgIHN0b3AoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgY3VycmVudENoaWxkV2lkdGgoY2I6IChcbiAgICBjdXJyZW50Q2xpbGRXaWR0aDogbnVtYmVyLFxuICAgIG5leHRDaGlsZHJlbldpZHRoOiBudW1iZXIsXG4gICAgY2hpbGRyZW5XaWR0aDogbnVtYmVyLFxuICAgIGluZGV4OiBudW1iZXIsXG4gICAgYnJlYWtGdW5jOiAoKSA9PiB2b2lkKSA9PiB2b2lkKSB7XG4gICAgbGV0IGNoaWxkcmVuV2lkdGggPSAwO1xuICAgIGxldCBzaG91bGRCcmVhayA9IGZhbHNlO1xuICAgIGNvbnN0IGJyZWFrRnVuYyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHNob3VsZEJyZWFrID0gdHJ1ZTtcbiAgICB9O1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5fY2hpbGRyZW5bJ19yZXN1bHRzJ10ubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChpID09PSB0aGlzLl9jaGlsZHJlblsnX3Jlc3VsdHMnXS5sZW5ndGggLSAxKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgaWYgKHNob3VsZEJyZWFrKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBuZXh0Q2hpbGRyZW5XaWR0aCA9IGNoaWxkcmVuV2lkdGggKyB0aGlzLl9jaGlsZHJlblsnX3Jlc3VsdHMnXVtpICsgMV0uX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5jbGllbnRXaWR0aDtcbiAgICAgIGNvbnN0IGN1cnJlbnRDbGlsZFdpZHRoID0gdGhpcy5fY2hpbGRyZW5bJ19yZXN1bHRzJ11baV0uX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5jbGllbnRXaWR0aDtcbiAgICAgIGNiKGN1cnJlbnRDbGlsZFdpZHRoLCBuZXh0Q2hpbGRyZW5XaWR0aCwgY2hpbGRyZW5XaWR0aCwgaSwgYnJlYWtGdW5jKTtcblxuICAgICAgY2hpbGRyZW5XaWR0aCArPSBjdXJyZW50Q2xpbGRXaWR0aDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHRvQ2hpbGRyZW5Mb2NhdGlvbigpOiBudW1iZXIge1xuICAgIGxldCB0byA9IHRoaXMuc2Nyb2xsYmFySGlkZGVuID8gdGhpcy5nZXRTY3JvbGxiYXJXaWR0aCgpIDogMDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuY3VyckluZGV4OyBpKyspIHtcbiAgICAgIHRvICs9IHRoaXMuX2NoaWxkcmVuWydfcmVzdWx0cyddW2ldLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuY2xpZW50V2lkdGg7XG4gICAgfVxuICAgIHJldHVybiB0bztcbiAgfVxuXG4gIHByaXZhdGUgbG9jYXRlRHJhZ1Njcm9sbEl0ZW0oZWxlbWVudDogRWxlbWVudCk6IERyYWdTY3JvbGxJdGVtRGlyZWN0aXZlIHwgbnVsbCB7XG4gICAgbGV0IGl0ZW06IERyYWdTY3JvbGxJdGVtRGlyZWN0aXZlIHwgbnVsbCA9IG51bGw7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLl9jaGlsZHJlblsnX3Jlc3VsdHMnXS5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGVsZW1lbnQgPT09IHRoaXMuX2NoaWxkcmVuWydfcmVzdWx0cyddW2ldLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQpIHtcbiAgICAgICAgaXRlbSA9IHRoaXMuX2NoaWxkcmVuWydfcmVzdWx0cyddW2ldO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaXRlbTtcbiAgfVxuXG4gIHByaXZhdGUgbWFya0VsRGltZW5zaW9uKCkge1xuICAgIGlmICh0aGlzLndyYXBwZXIpIHtcbiAgICAgIHRoaXMuZWxXaWR0aCA9IHRoaXMud3JhcHBlci5zdHlsZS53aWR0aDtcbiAgICAgIHRoaXMuZWxIZWlnaHQgPSB0aGlzLndyYXBwZXIuc3R5bGUuaGVpZ2h0O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmVsV2lkdGggPSB0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuc3R5bGUud2lkdGggfHwgKHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aCArICdweCcpO1xuICAgICAgdGhpcy5lbEhlaWdodCA9IHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5zdHlsZS5oZWlnaHQgfHwgKHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQgKyAncHgnKTtcbiAgICB9XG4gICAgY29uc3QgY29udGFpbmVyID0gdGhpcy53cmFwcGVyIHx8IHRoaXMucGFyZW50Tm9kZTtcbiAgICBjb25zdCBjb250YWluZXJXaWR0aCA9IGNvbnRhaW5lciA/IGNvbnRhaW5lci5jbGllbnRXaWR0aCA6IDA7XG4gICAgdGhpcy5pbmRleEJvdW5kID0gIHRoaXMubWF4aW11bUluZGV4KGNvbnRhaW5lcldpZHRoLCB0aGlzLl9jaGlsZHJlbik7XG4gIH1cblxuICBwcml2YXRlIG1heGltdW1JbmRleChjb250YWluZXJXaWR0aDogbnVtYmVyLCBjaGlsZHJlbkVsZW1lbnRzOiBRdWVyeUxpc3Q8RHJhZ1Njcm9sbEl0ZW1EaXJlY3RpdmU+KTogbnVtYmVyIHtcbiAgICBsZXQgY291bnQgPSAwO1xuICAgIGxldCBjaGlsZHJlbldpZHRoID0gMDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBjaGlsZHJlbkVsZW1lbnRzWydfcmVzdWx0cyddLmxlbmd0aDsgaSsrKSB7XG4gICAgICAvLyBsYXN0IE4gZWxlbWVudFxuICAgICAgY29uc3QgZHJhZ1Njcm9sbEl0ZW1EaXJlY3RpdmU6IERyYWdTY3JvbGxJdGVtRGlyZWN0aXZlID0gY2hpbGRyZW5FbGVtZW50c1snX3Jlc3VsdHMnXVtjaGlsZHJlbkVsZW1lbnRzWydfcmVzdWx0cyddLmxlbmd0aCAtIDEgLSBpXTtcbiAgICAgIGlmICghZHJhZ1Njcm9sbEl0ZW1EaXJlY3RpdmUpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjaGlsZHJlbldpZHRoICs9IGRyYWdTY3JvbGxJdGVtRGlyZWN0aXZlLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuY2xpZW50V2lkdGg7XG4gICAgICAgIGlmIChjaGlsZHJlbldpZHRoIDwgY29udGFpbmVyV2lkdGgpIHtcbiAgICAgICAgICBjb3VudCsrO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjaGlsZHJlbkVsZW1lbnRzLmxlbmd0aCAtIGNvdW50O1xuICB9XG5cbiAgcHJpdmF0ZSBpc1Njcm9sbFJlYWNoZXNSaWdodEVuZCgpOiBib29sZWFuIHtcbiAgICBjb25zdCBzY3JvbGxMZWZ0UG9zID0gdGhpcy5fY29udGVudFJlZi5uYXRpdmVFbGVtZW50LnNjcm9sbExlZnQgKyB0aGlzLl9jb250ZW50UmVmLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgcmV0dXJuIHNjcm9sbExlZnRQb3MgPj0gdGhpcy5fY29udGVudFJlZi5uYXRpdmVFbGVtZW50LnNjcm9sbFdpZHRoO1xuICB9XG5cbiAgLyoqXG4gICAqIGFkZHMgYSBtYXJnaW4gcmlnaHQgc3R5bGUgdG8gdGhlIGxhc3QgY2hpbGQgZWxlbWVudCB3aGljaCB3aWxsIHJlc29sdmUgdGhlIGlzc3VlXG4gICAqIG9mIGxhc3QgaXRlbSBnZXRzIGN1dG9mZi5cbiAgICovXG4gIHByaXZhdGUgYWRqdXN0TWFyZ2luVG9MYXN0Q2hpbGQoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuX2NoaWxkcmVuICYmIHRoaXMuaGlkZVNjcm9sbGJhcikge1xuICAgICAgY29uc3QgbGFzdEl0ZW0gPSB0aGlzLl9jaGlsZHJlblsnX3Jlc3VsdHMnXVt0aGlzLl9jaGlsZHJlblsnX3Jlc3VsdHMnXS5sZW5ndGggLSAxXS5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50O1xuICAgICAgaWYgKHRoaXMud3JhcHBlciAmJiB0aGlzLl9jaGlsZHJlblsnX3Jlc3VsdHMnXS5sZW5ndGggPiAxKSB7XG4gICAgICAgIHRoaXMuX3JlbmRlcmVyLnNldFN0eWxlKGxhc3RJdGVtLCAnbWFyZ2luLXJpZ2h0JywgdGhpcy5zY3JvbGxiYXJXaWR0aCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9yZW5kZXJlci5zZXRTdHlsZShsYXN0SXRlbSwgJ21hcmdpbi1yaWdodCcsIDApO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIl19